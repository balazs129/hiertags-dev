
/* cytoscape.renderer.canvas.min.js */

/**
 * This file is part of cytoscape.js 2.0.2-github-snapshot-2013.10.01-11.30.11.
 * 
 * Cytoscape.js is free software: you can redistribute it and/or modify it
 * under the terms of the GNU Lesser General Public License as published by the Free
 * Software Foundation, either version 3 of the License, or (at your option) any
 * later version.
 * 
 * Cytoscape.js is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS
 * FOR A PARTICULAR PURPOSE. See the GNU Lesser General Public License for more
 * details.
 * 
 * You should have received a copy of the GNU Lesser General Public License along with
 * cytoscape.js. If not, see <http://www.gnu.org/licenses/>.
 */
 
(function(w){var v=("ontouchstart" in window)||window.DocumentTouch&&document instanceof DocumentTouch;var m=function(){return Date.now()};var b={};var q={};var c=z.prototype;var p=400;var e=5,D=0,d=2,u=3,G=4,a=2;function z(I){this.options=I;this.data={select:[undefined,undefined,undefined,undefined,0],renderer:this,cy:I.cy,container:I.cy.container(),canvases:new Array(e),canvasRedrawReason:new Array(e),canvasNeedsRedraw:new Array(e),bufferCanvases:new Array(a)};this.hoverData={down:null,last:null,downTime:null,triggerMode:null,dragging:false,initialPan:[null,null],capture:false};
this.timeoutData={panTimeout:null};this.dragData={possibleDragElements:[]};this.touchData={start:null,capture:false,startPosition:[null,null,null,null,null,null],singleTouchStartTime:null,singleTouchMoved:true,now:[null,null,null,null,null,null],earlier:[null,null,null,null,null,null]};this.zoomData={freeToZoom:false,lastPointerX:null};this.redraws=0;this.bindings=[];this.init();for(var J=0;J<e;J++){this.data.canvases[J]=document.createElement("canvas");this.data.canvases[J].style.position="absolute";
this.data.canvases[J].setAttribute("data-id","layer"+J);this.data.canvases[J].style.zIndex=String(e-J);this.data.container.appendChild(this.data.canvases[J]);this.data.canvasRedrawReason[J]=new Array();this.data.canvasNeedsRedraw[J]=false}this.data.canvases[G].setAttribute("data-id","layer"+G+"-node");this.data.canvases[D].setAttribute("data-id","layer"+D+"-selectbox");this.data.canvases[d].setAttribute("data-id","layer"+d+"-drag");this.data.canvases[u].setAttribute("data-id","layer"+u+"-overlay");
for(var J=0;J<a;J++){this.data.bufferCanvases[J]=document.createElement("canvas");this.data.bufferCanvases[J].style.position="absolute";this.data.bufferCanvases[J].setAttribute("data-id","buffer"+J);this.data.bufferCanvases[J].style.zIndex=String(-J-1);this.data.bufferCanvases[J].style.visibility="visible";this.data.container.appendChild(this.data.bufferCanvases[J])}var H=document.createElement("div");this.data.container.appendChild(H);this.data.overlay=H;H.style.position="absolute";H.style.zIndex=1000;
if(I.showOverlay){var K=document.createElement("a");H.appendChild(K);this.data.link=K;K.innerHTML="cytoscape.js";K.style.font="14px helvetica";K.style.position="absolute";K.style.right=0;K.style.bottom=0;K.style.padding="1px 3px";K.style.paddingLeft="5px";K.style.paddingTop="5px";K.style.opacity=0;K.style["-webkit-tap-highlight-color"]="transparent";K.style.background="red";K.href="http://cytoscape.github.io/cytoscape.js/";K.target="_blank"}this.hideEdgesOnViewport=I.hideEdgesOnViewport;this.load()
}z.prototype.notify=function(i){if(i.type=="destroy"){this.destroy();return}else{if(i.type=="add"||i.type=="remove"||i.type=="load"){this.updateNodesCache();this.updateEdgesCache()}}if(i.type=="viewport"){this.data.canvasNeedsRedraw[D]=true;this.data.canvasRedrawReason[D].push("viewchange")}this.data.canvasNeedsRedraw[d]=true;this.data.canvasRedrawReason[d].push("notify");this.data.canvasNeedsRedraw[G]=true;this.data.canvasRedrawReason[G].push("notify");this.redraws++;this.redraw()};z.prototype.registerBinding=function(J,I,H,i){this.bindings.push({target:J,event:I,handler:H,useCapture:i});
J.addEventListener(I,H,i)};z.prototype.destroy=function(){this.destroyed=true;for(var I=0;I<this.bindings.length;I++){var J=this.bindings[I];var H=J;H.target.removeEventListener(H.event,H.handler,H.useCapture)}};z.prototype.png=function(){var H=this.data;if(this.data.container.clientHeight>0&&this.data.container.clientWidth>0){context=H.bufferCanvases[1].getContext("2d");context.globalCompositeOperation="copy";context.drawImage(H.canvases[4],0,0);context.globalCompositeOperation="source-over";context.drawImage(H.canvases[2],0,0);
context.drawImage(H.canvases[0],0,0);context=H.bufferCanvases[0].getContext("2d");context.globalCompositeOperation="copy";context.drawImage(H.bufferCanvases[1],0,0)}var i=this.data.bufferCanvases[0];return i.toDataURL("image/png")};z.prototype.load=function(){var R=this;var P=function(ad,Y,ae){if(!Y){var ab=ad.parents();for(var ac=0;ac<ab.size();ac++){if(ab[ac]._private.selected){return}}}var af=ad.descendants();function aa(ah){while(ah.parent().nonempty()&&ah.parent().id()!==ad.id()){parent=ah.parent()[0];
var ag=parent._private.style;if(ag.width.value!=="auto"||ag.height.value!=="auto"){return true}ah=ah.parent()}return false}for(var ac=0;ac<af.size();ac++){if((Y||!af[ac]._private.selected)){af[ac]._private.rscratch.inDragLayer=true;ae.push(af[ac]);for(var Z=0;Z<af[ac]._private.edges.length;Z++){af[ac]._private.edges[Z]._private.rscratch.inDragLayer=true}}}};var S=function(Z,aa){Z._private.grabbed=true;Z._private.rscratch.inDragLayer=true;aa.push(Z);for(var Y=0;Y<Z._private.edges.length;Y++){Z._private.edges[Y]._private.rscratch.inDragLayer=true
}};var W=function(ad,ab){var ac=ad;while(ac.parent().nonempty()){ac=ac.parent()[0]}if(ac==ad&&ab){return}var Y=ac.descendants().add(ac);for(var aa=0;aa<Y.size();aa++){Y[aa]._private.rscratch.inDragLayer=ab;for(var Z=0;Z<Y[aa]._private.edges.length;Z++){Y[aa]._private.edges[Z]._private.rscratch.inDragLayer=ab}}};z.prototype.nodeIsDraggable=function(Y){if(Y._private.style.opacity.value!=0&&Y._private.style.visibility.value=="visible"&&!Y._private.locked&&Y._private.grabbable){return true}return false
};R.registerBinding(window,"resize",function(Y){R.data.canvasNeedsRedraw[G]=true;R.data.canvasNeedsRedraw[u]=true;R.matchCanvasSize(R.data.container);R.redraw()},true);R.registerBinding(R.data.container,"contextmenu",function(Y){Y.preventDefault()});R.registerBinding(R.data.container,"mousedown",function(ab){ab.preventDefault();R.hoverData.capture=true;R.hoverData.which=ab.which;var Y=R.data.cy;var ae=R.projectIntoViewport(ab.pageX,ab.pageY);var af=R.data.select;var aa=R.findNearestElement(ae[0],ae[1],true);
var ah=R.hoverData.down;var ac=R.dragData.possibleDragElements;var ad=new w.Event(ab,{type:"grab"});if(ab.which==3){if(aa){aa.activate();aa.trigger(new w.Event(ab,{type:"cxttapstart"}));R.hoverData.down=aa;R.hoverData.downTime=(new Date()).getTime();R.hoverData.cxtDragged=false}}else{if(ab.which==1){if(aa){aa.activate()}if(aa!=null&&R.nodeIsDraggable(aa)){if(aa._private.group=="nodes"&&aa._private.selected==false){ac=R.dragData.possibleDragElements=[];S(aa,ac);aa.trigger(ad);if(aa._private.style.width.value=="auto"||aa._private.style.height.value=="auto"){P(aa,true,ac)
}W(aa,true)}if(aa._private.group=="nodes"&&aa._private.selected==true){ac=R.dragData.possibleDragElements=[];var ai=false;var ag=Y.$("node:selected");for(var Z=0;Z<ag.length;Z++){if(R.nodeIsDraggable(ag[Z])){S(ag[Z],ac);if(!ai){aa.trigger(ad);ai=true}if(ag[Z]._private.style.width.value=="auto"||ag[Z]._private.style.height.value=="auto"){P(ag[Z],false,ac)}W(ag[Z],true)}}}aa.trigger(new w.Event(ab,{type:"mousedown"})).trigger(new w.Event(ab,{type:"tapstart"})).trigger(new w.Event(ab,{type:"vmousedown"}))
}else{if(aa==null){Y.trigger(new w.Event(ab,{type:"mousedown"})).trigger(new w.Event(ab,{type:"tapstart"})).trigger(new w.Event(ab,{type:"vmousedown"}))}}R.hoverData.down=aa;R.hoverData.downTime=(new Date()).getTime();if(aa==null||aa.isEdge()){af[4]=1;var aj=Math.max(0,p-(+new Date-R.hoverData.downTime));clearTimeout(R.bgActiveTimeout);R.bgActiveTimeout=setTimeout(function(){if(aa){aa.unactivate()}R.data.bgActivePosistion={x:ae[0],y:ae[1]};R.data.canvasNeedsRedraw[D]=true;R.data.canvasRedrawReason[D].push("bgactive");
R.redraw()},aj)}}}af[0]=af[2]=ae[0];af[1]=af[3]=ae[1];R.redraw()},false);R.registerBinding(window,"mousemove",function(ap){var af=false;var al=R.hoverData.capture;if(!al){var ag=R.findContainerPageCoords();if(ap.pageX>ag[0]&&ap.pageX<ag[0]+R.data.container.clientWidth&&ap.pageY>ag[1]&&ap.pageY<ag[1]+R.data.container.clientHeight){}else{return}}var aa=R.data.cy;var ae=R.projectIntoViewport(ap.pageX,ap.pageY);var aj=R.data.select;var aq=R.findNearestElement(ae[0],ae[1],true);var ah=R.hoverData.last;
var ai=R.hoverData.down;var am=[ae[0]-aj[2],ae[1]-aj[3]];var ak=R.getCachedNodes();var Z=R.getCachedEdges();var ac=R.dragData.possibleDragElements;var ab=ap.shiftKey;af=true;var an=new w.Event(ap,{type:"mousemove"});if(aq!=null){aq.trigger(an)}else{if(aq==null){aa.trigger(an)}}if(R.hoverData.which===3){var ad=new w.Event(ap,{type:"cxtdrag"});if(ai){ai.trigger(ad)}else{aa.trigger(ad)}R.hoverData.cxtDragged=true}else{if(R.hoverData.dragging){af=true;if(aa.panningEnabled()){var Y={x:am[0]*aa.zoom(),y:am[1]*aa.zoom()};
aa.panBy(Y)}ae=R.projectIntoViewport(ap.pageX,ap.pageY)}else{if(aj[4]==1&&(ai==null||ai.isEdge())&&(!aa.boxSelectionEnabled()||+new Date-R.hoverData.downTime>=p)&&(Math.abs(aj[3]-aj[1])+Math.abs(aj[2]-aj[0])<4)&&aa.panningEnabled()){R.hoverData.dragging=true;aj[4]=0}else{if(aa.boxSelectionEnabled()&&Math.pow(aj[2]-aj[0],2)+Math.pow(aj[3]-aj[1],2)>7&&aj[4]){clearTimeout(R.bgActiveTimeout)}if(ai&&ai.isEdge()&&ai.active()){ai.unactivate()}if(aq!=ah){if(ah){ah.trigger(new w.Event(ap,{type:"mouseout"}))
}if(aq){aq.trigger(new w.Event(ap,{type:"mouseover"}))}R.hoverData.last=aq}if(ai&&ai.isNode()&&R.nodeIsDraggable(ai)){R.dragData.didDrag=true;var ar=[];for(var ao=0;ao<ac.length;ao++){if(ac[ao]._private.group=="nodes"&&R.nodeIsDraggable(ac[ao])){ac[ao]._private.position.x+=am[0];ac[ao]._private.position.y+=am[1];ar.push(ac[ao])}}(new w.Collection(aa,ar)).trigger(new w.Event(ap,{type:"drag"})).trigger(new w.Event(ap,{type:"position"}));if(aj[2]==aj[0]&&aj[3]==aj[1]){R.data.canvasNeedsRedraw[G]=true;
R.data.canvasRedrawReason[G].push("Node(s) and edge(s) moved to drag layer")}R.data.canvasNeedsRedraw[d]=true;R.data.canvasRedrawReason[d].push("Nodes dragged")}if(aa.boxSelectionEnabled()){R.data.canvasNeedsRedraw[D]=true;R.data.canvasRedrawReason[D].push("Mouse moved, redraw selection box")}af=true}}}aj[2]=ae[0];aj[3]=ae[1];R.redraw();if(af){if(ap.stopPropagation){ap.stopPropagation()}if(ap.preventDefault){ap.preventDefault()}ap.cancelBubble=true;ap.returnValue=false;return false}},false);R.registerBinding(window,"mouseup",function(at){var am=R.hoverData.capture;
if(!am){return}R.hoverData.capture=false;var Z=R.data.cy;var ae=R.projectIntoViewport(at.pageX,at.pageY);var ak=R.data.select;var au=R.findNearestElement(ae[0],ae[1],true);var al=R.getCachedNodes();var Y=R.getCachedEdges();var ac=R.dragData.possibleDragElements;var ag=R.hoverData.down;var ab=at.shiftKey;R.data.bgActivePosistion=undefined;clearTimeout(R.bgActiveTimeout);if(ag){ag.unactivate()}if(R.hoverData.which===3){var ad=new w.Event(at,{type:"cxttapend"});if(ag){ag.trigger(ad)}else{Z.trigger(ad)
}if(!R.hoverData.cxtDragged){var aj=new w.Event(at,{type:"cxttap"});if(ag){ag.trigger(aj)}else{Z.trigger(aj)}}R.hoverData.cxtDragged=false;R.hoverData.which=null}else{if((ag==null)&&!R.dragData.didDrag&&!(Math.pow(ak[2]-ak[0],2)+Math.pow(ak[3]-ak[1],2)>7&&ak[4])&&!R.hoverData.dragging){Z.$(":selected").unselect();if(ac.length>0){R.data.canvasNeedsRedraw[G]=true;R.data.canvasRedrawReason[G].push("De-select")}R.dragData.possibleDragElements=ac=[]}if(Math.pow(ak[2]-ak[0],2)+Math.pow(ak[3]-ak[1],2)==0){if(au!=null){au.trigger(new w.Event(at,{type:"click"})).trigger(new w.Event(at,{type:"tap"})).trigger(new w.Event(at,{type:"vclick"}))
}else{if(au==null){Z.trigger(new w.Event(at,{type:"click"})).trigger(new w.Event(at,{type:"tap"})).trigger(new w.Event(at,{type:"vclick"}))}}}if(au!=null){au.trigger(new w.Event(at,{type:"mouseup"})).trigger(new w.Event(at,{type:"tapend"})).trigger(new w.Event(at,{type:"vmouseup"}))}else{if(au==null){Z.trigger(new w.Event(at,{type:"mouseup"})).trigger(new w.Event(at,{type:"tapend"})).trigger(new w.Event(at,{type:"vmouseup"}))}}if(au==ag&&!R.dragData.didDrag){if(au!=null&&au._private.selectable){if(!ab){Z.$(":selected").unselect()
}if(au.selected()){au.unselect()}else{au.select()}W(au,false);R.data.canvasNeedsRedraw[G]=true;R.data.canvasRedrawReason[G].push("sglslct")}}else{if(au==ag){if(au!=null&&au._private.grabbed){var an=Z.$(":grabbed");for(var aq=0;aq<an.length;aq++){var ah=an[aq];ah._private.grabbed=false;var ai=ah._private.edges;for(var ap=0;ap<ai.length;ap++){ai[ap]._private.rscratch.inDragLayer=false}W(ah,false)}var ar=new w.Event(at,{type:"free"});an.trigger(ar)}}}if(Z.boxSelectionEnabled()&&Math.pow(ak[2]-ak[0],2)+Math.pow(ak[3]-ak[1],2)>7&&ak[4]){if(!ab){Z.$(":selected").unselect()
}var aa=[];var af=R.getAllInBox(ak[0],ak[1],ak[2],ak[3]);var ao=new w.Event(at,{type:"select"});for(var aq=0;aq<af.length;aq++){if(af[aq]._private.selectable){ac.push(af[aq]);aa.push(af[aq])}}(new w.Collection(Z,aa)).select();if(af.length>0){R.data.canvasNeedsRedraw[G]=true;R.data.canvasRedrawReason[G].push("Selection")}}R.hoverData.dragging=false;if(!ak[4]){var ar=new w.Event(at,{type:"free"});for(var aq=0;aq<ac.length;aq++){if(ac[aq]._private.group=="nodes"){ac[aq]._private.rscratch.inDragLayer=false;
var ai=ac[aq]._private.edges;for(var ap=0;ap<ai.length;ap++){ai[ap]._private.rscratch.inDragLayer=false}W(ac[aq],false)}else{if(ac[aq]._private.group=="edges"){ac[aq]._private.rscratch.inDragLayer=false}}}if(ag){ag.trigger(ar)}R.data.canvasNeedsRedraw[d]=true;R.data.canvasRedrawReason[d].push("Node/nodes back from drag");R.data.canvasNeedsRedraw[G]=true;R.data.canvasRedrawReason[G].push("Node/nodes back from drag")}}ak[4]=0;R.hoverData.down=null;R.data.canvasNeedsRedraw[D]=true;R.data.canvasRedrawReason[D].push("Mouse up, selection box gone");
R.dragData.didDrag=false;R.redraw()},false);var M=function(aa){if(aa.srcElement!==R.data.overlay){return}var ac=R.data.cy;var ab=R.projectIntoViewport(aa.pageX,aa.pageY);var Z=[ab[0]*ac.zoom()+ac.pan().x,ab[1]*ac.zoom()+ac.pan().y];if(R.zoomData.freeToZoom){aa.preventDefault();var Y=aa.wheelDeltaY/1000||aa.wheelDelta/1000||aa.detail/-32;if(ac.panningEnabled()&&ac.zoomingEnabled()){ac.zoom({level:ac.zoom()*Math.pow(10,Y),position:{x:Z[0],y:Z[1]}})}R.data.wheel=true;clearTimeout(R.data.wheelTimeout);
R.data.wheelTimeout=setTimeout(function(){R.data.wheel=false;R.data.canvasNeedsRedraw[G]=true;R.redraw()},100)}};R.registerBinding(R.data.container,"mousewheel",M,true);R.registerBinding(R.data.container,"DOMMouseScroll",M,true);R.registerBinding(R.data.container,"MozMousePixelScroll",function(Y){if(R.zoomData.freeToZoom){Y.preventDefault()}},false);R.registerBinding(R.data.container,"mousemove",function(Y){if(R.zoomData.lastPointerX&&R.zoomData.lastPointerX!=Y.pageX&&!R.zoomData.freeToZoom){R.zoomData.freeToZoom=true
}R.zoomData.lastPointerX=Y.pageX},false);R.registerBinding(R.data.container,"mouseout",function(Y){R.zoomData.freeToZoom=false;R.zoomData.lastPointerX=null},false);R.registerBinding(R.data.container,"mouseout",function(Y){R.data.cy.trigger(new w.Event(Y,{type:"mouseout"}))},false);R.registerBinding(R.data.container,"mouseover",function(Y){R.data.cy.trigger(new w.Event(Y,{type:"mouseover"}))},false);var H,N,T,X;var U;var K,J;var L,V;var O=R.data.container.clientWidth,Q=R.data.container.clientHeight;
var i;function I(Z,ab,Y,aa){return Math.sqrt((Y-Z)*(Y-Z)+(aa-ab)*(aa-ab))}R.registerBinding(R.data.container,"touchstart",function(au){if(au.target!==R.data.link){au.preventDefault()}R.touchData.capture=true;R.data.bgActivePosistion=undefined;var ab=R.data.cy;var am=R.getCachedNodes();var aa=R.getCachedEdges();var Z=R.touchData.now;var aq=R.touchData.earlier;if(au.touches[0]){var ae=R.projectIntoViewport(au.touches[0].pageX,au.touches[0].pageY);Z[0]=ae[0];Z[1]=ae[1]}if(au.touches[1]){var ae=R.projectIntoViewport(au.touches[1].pageX,au.touches[1].pageY);
Z[2]=ae[0];Z[3]=ae[1]}if(au.touches[2]){var ae=R.projectIntoViewport(au.touches[2].pageX,au.touches[2].pageY);Z[4]=ae[0];Z[5]=ae[1]}if(au.touches[1]){function at(aw){for(var ax=0;ax<aw.length;ax++){aw[ax]._private.grabbed=false;aw[ax]._private.rscratch.inDragLayer=false;if(aw[ax].active()){aw[ax].unactivate()}}}at(am);at(aa);var ad=R.findContainerPageCoords();V=ad[1];L=ad[0];H=au.touches[0].pageX-L;N=au.touches[0].pageY-V;T=au.touches[1].pageX-L;X=au.touches[1].pageY-V;i=0<=H&&H<=O&&0<=T&&T<=O&&0<=N&&N<=Q&&0<=X&&X<=Q;
var al=ab.pan();var Y=ab.zoom();U=I(H,N,T,X);K=[(H+T)/2,(N+X)/2];J=[(K[0]-al.x)/Y,(K[1]-al.y)/Y];if(U<100){var ag=R.findNearestElement(Z[0],Z[1],true);var af=R.findNearestElement(Z[2],Z[3],true);var ac=new w.Event(au,{type:"cxttapstart"});if(ag&&ag.isNode()){ag.activate().trigger(ac);R.touchData.start=ag}else{if(af&&af.isNode()){af.activate().trigger(ac);R.touchData.start=af}else{ab.trigger(ac);R.touchData.start=null}}if(R.touchData.start){R.touchData.start._private.grabbed=false}R.touchData.cxt=true;
R.touchData.cxtDragged=false;R.data.bgActivePosistion=undefined;R.redraw();return}}if(au.touches[2]){}else{if(au.touches[1]){}else{if(au.touches[0]){var av=R.findNearestElement(Z[0],Z[1],true);if(av!=null){av.activate();R.touchData.start=av;if(av._private.group=="nodes"&&R.nodeIsDraggable(av)){var ah=R.dragData.touchDragEles=[];S(av,ah);av.trigger(new w.Event(au,{type:"grab"}));if(av.selected()){ah=R.dragData.touchDragEles=[];var aj=ab.$("node:selected");for(var an=0;an<aj.length;an++){var ar=aj[an];
if(R.nodeIsDraggable(ar)){ah.push(ar);ar._private.rscratch.inDragLayer=true;var ai=ar._private.edges;for(var ao=0;ao<ai.length;ao++){ai[ao]._private.rscratch.inDragLayer=true}if(ar._private.style.width.value=="auto"||ar._private.style.height.value=="auto"){P(ar,false,ah)}W(ar,true)}}}else{if(av._private.style.width.value=="auto"||av._private.style.height.value=="auto"){P(av,true,ah)}W(av,true)}}av.trigger(new w.Event(au,{type:"touchstart"})).trigger(new w.Event(au,{type:"tapstart"})).trigger(new w.Event(au,{type:"vmousdown"}))
}if(av==null){ab.trigger(new w.Event(au,{type:"touchstart"})).trigger(new w.Event(au,{type:"tapstart"})).trigger(new w.Event(au,{type:"vmousedown"}));R.data.bgActivePosistion={x:ae[0],y:ae[1]};R.data.canvasNeedsRedraw[D]=true;R.data.canvasRedrawReason[D].push("bgactive")}for(var ap=0;ap<Z.length;ap++){aq[ap]=Z[ap];R.touchData.startPosition[ap]=Z[ap]}R.touchData.singleTouchMoved=false;R.touchData.singleTouchStartTime=m();var ak=setTimeout(function(){if(R.touchData.singleTouchMoved==false&&m()-R.touchData.singleTouchStartTime>250){if(R.touchData.start){R.touchData.start.trigger(new w.Event(au,{type:"taphold"}))
}else{R.data.cy.trigger(new w.Event(au,{type:"taphold"}));ab.$(":selected").unselect()}}},1000)}}}R.redraw()},false);R.registerBinding(window,"touchmove",function(aH){var aA=R.data.select;var an=R.touchData.capture;an&&aH.preventDefault();var al=R.data.cy;var aw=R.getCachedNodes();var af=R.getCachedEdges();var az=R.touchData.now;var Z=R.touchData.earlier;if(aH.touches[0]){var aq=R.projectIntoViewport(aH.touches[0].pageX,aH.touches[0].pageY);az[0]=aq[0];az[1]=aq[1]}if(aH.touches[1]){var aq=R.projectIntoViewport(aH.touches[1].pageX,aH.touches[1].pageY);
az[2]=aq[0];az[3]=aq[1]}if(aH.touches[2]){var aq=R.projectIntoViewport(aH.touches[2].pageX,aH.touches[2].pageY);az[4]=aq[0];az[5]=aq[1]}var ab=[];for(var aE=0;aE<az.length;aE++){ab[aE]=az[aE]-Z[aE]}if(an&&R.touchData.cxt){var ap=aH.touches[0].pageX-L,ac=aH.touches[0].pageY-V;var ak=aH.touches[1].pageX-L,Y=aH.touches[1].pageY-V;var au=I(ap,ac,ak,Y);var aF=au/U;if(aF>=1.5||au>=150){R.touchData.cxt=false;if(R.touchData.start){R.touchData.start.unactivate();R.touchData.start=null}R.data.bgActivePosistion=undefined;
R.data.canvasNeedsRedraw[D]=true;var aa=new w.Event(aH,{type:"cxttapend"});if(R.touchData.start){R.touchData.start.trigger(aa)}else{al.trigger(aa)}}}if(an&&R.touchData.cxt){var aa=new w.Event(aH,{type:"cxtdrag"});R.data.bgActivePosistion=undefined;R.data.canvasNeedsRedraw[D]=true;if(R.touchData.start){R.touchData.start.trigger(aa)}else{al.trigger(aa)}if(R.touchData.start){R.touchData.start._private.grabbed=false}R.touchData.cxtDragged=true}else{if(an&&aH.touches[2]&&al.boxSelectionEnabled()){R.data.bgActivePosistion=undefined;
clearTimeout(this.threeFingerSelectTimeout);this.lastThreeTouch=+new Date;R.data.canvasNeedsRedraw[D]=true;R.data.canvasRedrawReason[D].push("Touch moved, redraw selection box");if(!aA||aA.length===0||aA[0]===undefined){aA[0]=(az[0]+az[2]+az[4])/3;aA[1]=(az[1]+az[3]+az[5])/3;aA[2]=(az[0]+az[2]+az[4])/3+1;aA[3]=(az[1]+az[3]+az[5])/3+1}else{aA[2]=(az[0]+az[2]+az[4])/3;aA[3]=(az[1]+az[3]+az[5])/3}aA[4]=1}else{if(an&&aH.touches[1]&&al.zoomingEnabled()&&al.panningEnabled()){R.data.bgActivePosistion=undefined;
R.data.canvasNeedsRedraw[D]=true;var ap=aH.touches[0].pageX-L,ac=aH.touches[0].pageY-V;var ak=aH.touches[1].pageX-L,Y=aH.touches[1].pageY-V;var au=I(ap,ac,ak,Y);var aF=au/U;if(aF!=1&&i){var aJ=ap-H;var aI=ac-N;var av=ak-T;var at=Y-X;var aD=(aJ+av)/2;var aB=(aI+at)/2;var ae=al.zoom();var ad=ae*aF;var ah=al.pan();var ay=J[0]*ae+ah.x;var ax=J[1]*ae+ah.y;var ag={x:-ad/ae*(ay-ah.x-aD)+ay,y:-ad/ae*(ax-ah.y-aB)+ax};al._private.zoom=ad;al._private.pan=ag;al.trigger("pan zoom").notify("viewport");U=au;H=ap;
N=ac;T=ak;X=Y;R.pinching=true}if(aH.touches[0]){var aq=R.projectIntoViewport(aH.touches[0].pageX,aH.touches[0].pageY);az[0]=aq[0];az[1]=aq[1]}if(aH.touches[1]){var aq=R.projectIntoViewport(aH.touches[1].pageX,aH.touches[1].pageY);az[2]=aq[0];az[3]=aq[1]}if(aH.touches[2]){var aq=R.projectIntoViewport(aH.touches[2].pageX,aH.touches[2].pageY);az[4]=aq[0];az[5]=aq[1]}}else{if(aH.touches[0]){var ao=R.touchData.start;var ai=R.touchData.last;if(ao!=null&&ao._private.group=="nodes"&&R.nodeIsDraggable(ao)){var aj=R.dragData.touchDragEles;
for(var aC=0;aC<aj.length;aC++){var am=aj[aC];if(R.nodeIsDraggable(am)){R.dragData.didDrag=true;am._private.position.x+=ab[0];am._private.position.y+=ab[1]}}(new w.Collection(al,aj)).trigger(new w.Event(aH,{type:"drag"})).trigger(new w.Event(aH,{type:"position"}));R.data.canvasNeedsRedraw[d]=true;R.data.canvasRedrawReason[d].push("touchdrag node");if(R.touchData.startPosition[0]==Z[0]&&R.touchData.startPosition[1]==Z[1]){R.data.canvasNeedsRedraw[G]=true;R.data.canvasRedrawReason[G].push("node drag started")
}}if(ao!=null){ao.trigger(new w.Event(aH,{type:"touchmove"}))}if(ao==null){var ar=R.findNearestElement(az[0],az[1],true);if(ar!=null){ar.trigger(new w.Event(aH,{type:"touchmove"}))}if(ar==null){al.trigger(new w.Event(aH,{type:"touchmove"}))}}if(ar!=ai){if(ai){ai.trigger(new w.Event(aH,{type:"touchout"}))}if(ar){ar.trigger(new w.Event(aH,{type:"touchover"}))}}R.touchData.last=ar;for(var aG=0;aG<az.length;aG++){if(az[aG]&&R.touchData.startPosition[aG]&&Math.abs(az[aG]-R.touchData.startPosition[aG])>4){R.touchData.singleTouchMoved=true
}}if(an&&(ao==null||ao.isEdge())&&al.panningEnabled()){if(ao){ao.unactivate();if(!R.data.bgActivePosistion){R.data.bgActivePosistion={x:az[0],y:az[1]}}R.data.canvasNeedsRedraw[D]=true;R.data.canvasRedrawReason[D].push("bgactive")}al.panBy({x:ab[0]*al.zoom(),y:ab[1]*al.zoom()});R.swipePanning=true;var aq=R.projectIntoViewport(aH.touches[0].pageX,aH.touches[0].pageY);az[0]=aq[0];az[1]=aq[1]}}}}}for(var aE=0;aE<az.length;aE++){Z[aE]=az[aE]}R.redraw()},false);R.registerBinding(window,"touchend",function(aq){var aj=R.touchData.capture;
if(!aj){return}R.touchData.capture=false;aq.preventDefault();var ag=R.data.select;R.swipePanning=false;var ab=R.data.cy;var ai=R.getCachedNodes();var aa=R.getCachedEdges();var Z=R.touchData.now;var an=R.touchData.earlier;var ac=R.touchData.start;if(aq.touches[0]){var ad=R.projectIntoViewport(aq.touches[0].pageX,aq.touches[0].pageY);Z[0]=ad[0];Z[1]=ad[1]}if(aq.touches[1]){var ad=R.projectIntoViewport(aq.touches[1].pageX,aq.touches[1].pageY);Z[2]=ad[0];Z[3]=ad[1]}if(aq.touches[2]){var ad=R.projectIntoViewport(aq.touches[2].pageX,aq.touches[2].pageY);
Z[4]=ad[0];Z[5]=ad[1]}if(R.touchData.cxt){ctxTapend=new w.Event(aq,{type:"cxttapend"});if(ac){ac.unactivate();ac.trigger(ctxTapend)}else{ab.trigger(ctxTapend)}if(!R.touchData.cxtDragged){var ah=new w.Event(aq,{type:"cxttap"});if(ac){ac.trigger(ah)}else{ab.trigger(ah)}}if(R.touchData.start){R.touchData.start._private.grabbed=false}R.touchData.cxt=false;R.touchData.start=null;R.redraw();return}var Y=+new Date;if(!aq.touches[2]&&ab.boxSelectionEnabled()){clearTimeout(this.threeFingerSelectTimeout);this.threeFingerSelectTimeout=setTimeout(function(){var ar=[];
var av=R.getAllInBox(ag[0],ag[1],ag[2],ag[3]);ag[0]=undefined;ag[1]=undefined;ag[2]=undefined;ag[3]=undefined;ag[4]=0;R.data.canvasNeedsRedraw[D]=true;R.data.canvasRedrawReason[D].push("Touch moved, redraw selection box");var au=new w.Event(aq,{type:"select"});for(var at=0;at<av.length;at++){if(av[at]._private.selectable){ar.push(av[at])}}(new w.Collection(ab,ar)).select();if(av.length>0){R.data.canvasNeedsRedraw[G]=true;R.data.canvasRedrawReason[G].push("Selection")}},100)}if(!aq.touches[1]){R.pinching=false
}var al=false;if(ac!=null){ac._private.active=false;al=true;ac.trigger(new w.Event(aq,{type:"unactivate"}))}if(aq.touches[2]){R.data.bgActivePosistion=undefined}else{if(aq.touches[1]){}else{if(aq.touches[0]){}else{if(!aq.touches[0]){R.data.bgActivePosistion=undefined;if(ac!=null){if(ac._private.grabbed==true){ac._private.grabbed=false;ac.trigger(new w.Event(aq,{type:"free"}));ac._private.rscratch.inDragLayer=false}var af=ac._private.edges;for(var am=0;am<af.length;am++){af[am]._private.rscratch.inDragLayer=false
}W(ac,false);if(ac.selected()){var ae=ab.$("node:selected");for(var ak=0;ak<ae.length;ak++){var ao=ae[ak];ao._private.rscratch.inDragLayer=false;var af=ao._private.edges;for(var am=0;am<af.length;am++){af[am]._private.rscratch.inDragLayer=false}W(ao,false)}}R.data.canvasNeedsRedraw[d]=true;R.data.canvasRedrawReason[d].push("touchdrag node end");R.data.canvasNeedsRedraw[G]=true;R.data.canvasRedrawReason[G].push("touchdrag node end");ac.trigger(new w.Event(aq,{type:"touchend"})).trigger(new w.Event(aq,{type:"tapend"})).trigger(new w.Event(aq,{type:"vmouseup"}));
R.touchData.start=null}else{var ap=R.findNearestElement(Z[0],Z[1],true);if(ap!=null){ap.trigger(new w.Event(aq,{type:"touchend"})).trigger(new w.Event(aq,{type:"tapend"})).trigger(new w.Event(aq,{type:"vmouseup"}))}if(ap==null){ab.trigger(new w.Event(aq,{type:"touchend"})).trigger(new w.Event(aq,{type:"tapend"})).trigger(new w.Event(aq,{type:"vmouseup"}))}}if(ac!=null&&!R.dragData.didDrag&&ac._private.selectable&&(Math.sqrt(Math.pow(R.touchData.startPosition[0]-Z[0],2)+Math.pow(R.touchData.startPosition[1]-Z[1],2)))<6){if(ac.selected()){ac._private.selected=false;
ac.trigger(new w.Event(aq,{type:"unselect"}))}else{ac._private.selected=true;ac.trigger(new w.Event(aq,{type:"select"}))}al=true;R.data.canvasNeedsRedraw[G]=true;R.data.canvasRedrawReason[G].push("sglslct")}if(R.touchData.singleTouchMoved==false){if(ac){ac.trigger(new w.Event(aq,{type:"tap"})).trigger(new w.Event(aq,{type:"vclick"}))}else{ab.trigger(new w.Event(aq,{type:"tap"})).trigger(new w.Event(aq,{type:"vclick"}))}}R.touchData.singleTouchMoved=true}}}}for(var am=0;am<Z.length;am++){an[am]=Z[am]
}R.dragData.didDrag=false;if(al&&ac){ac.updateStyle(false)}R.redraw()},false)};z.prototype.init=function(){};z.prototype.getCachedNodes=function(){var i=this.data;var H=this.data.cy;if(i.cache==undefined){i.cache={}}if(i.cache.cachedNodes==undefined){i.cache.cachedNodes=H.nodes()}return i.cache.cachedNodes};z.prototype.updateNodesCache=function(){var i=this.data;var H=this.data.cy;if(i.cache==undefined){i.cache={}}i.cache.cachedNodes=H.nodes()};z.prototype.getCachedEdges=function(){var i=this.data;
var H=this.data.cy;if(i.cache==undefined){i.cache={}}if(i.cache.cachedEdges==undefined){i.cache.cachedEdges=H.edges()}return i.cache.cachedEdges};z.prototype.updateEdgesCache=function(){var i=this.data;var H=this.data.cy;if(i.cache==undefined){i.cache={}}i.cache.cachedEdges=H.edges()};z.prototype.projectIntoViewport=function(I,i){n=this.data.container;var L=false;var J=this.findContainerPageCoords();var K=J[0];var H=J[1];x=I-K;y=i-H;x-=this.data.cy.pan().x;y-=this.data.cy.pan().y;x/=this.data.cy.zoom();
y/=this.data.cy.zoom();return[x,y]};z.prototype.findContainerPageCoords=function(){var i,M;var J=0;var I=0;var L;L=this.data.container;var K=false;while(L!=null){var H=window.getComputedStyle(L);if(H.getPropertyValue("position").toLowerCase()==="fixed"){J=L.offsetLeft+window.scrollX;I=L.offsetTop+window.scrollY;L=null}else{if(typeof(L.offsetLeft)=="number"){J+=L.offsetLeft;I+=L.offsetTop;if(L==document.body||L==document.header){K=true}if(!K){J-=L.scrollLeft;I-=L.scrollTop}}}if(L){L=L.offsetParent
}}return[J,I]};z.prototype.findNearestElement=function(V,U,J){var Q=this.data;var K=this.getCachedNodes();var O=this.getCachedEdges();var R=[];var W=this.data.cy.zoom();var M=(v?256:32)/W;var T=(v?16:0)/W;for(var P=0;P<K.length;P++){if(q[this.getNodeShape(K[P])].checkPointRough(V,U,K[P]._private.style["border-width"].value/2,this.getNodeWidth(K[P])+T,this.getNodeHeight(K[P])+T,K[P]._private.position.x,K[P]._private.position.y)&&q[this.getNodeShape(K[P])].checkPoint(V,U,K[P]._private.style["border-width"].value/2,(this.getNodeWidth(K[P])+T),(this.getNodeHeight(K[P])+T),K[P]._private.position.x,K[P]._private.position.y)){if(J){if(K[P]._private.style.opacity.value!=0&&K[P]._private.style.visibility.value=="visible"){R.push(K[P])
}}else{R.push(K[P])}}}var I;for(var P=0;P<O.length;P++){var L=O[P];var N=L._private.rscratch;I=false;if(N.edgeType=="self"){if((this.inBezierVicinity(V,U,N.startX,N.startY,N.cp2ax,N.cp2ay,N.selfEdgeMidX,N.selfEdgeMidY,Math.pow(L._private.style.width.value/2,2))&&(Math.pow(O[P]._private.style.width.value/2,2)+M>this.sqDistanceToQuadraticBezier(V,U,N.startX,N.startY,N.cp2ax,N.cp2ay,N.selfEdgeMidX,N.selfEdgeMidY)))||(this.inBezierVicinity(V,U,N.selfEdgeMidX,N.selfEdgeMidY,N.cp2cx,N.cp2cy,N.endX,N.endY,Math.pow(O[P]._private.style.width.value/2,2))&&(Math.pow(O[P]._private.style.width.value/2,2)+M>this.sqDistanceToQuadraticBezier(V,U,N.selfEdgeMidX,N.selfEdgeMidY,N.cp2cx,N.cp2cy,N.endX,N.endY)))){I=true
}}else{if(N.edgeType=="straight"){if(this.inLineVicinity(V,U,N.startX,N.startY,N.endX,N.endY,O[P]._private.style.width.value*2)&&Math.pow(O[P]._private.style.width.value/2,2)+M>this.sqDistanceToFiniteLine(V,U,N.startX,N.startY,N.endX,N.endY)){I=true}}else{if(N.edgeType=="bezier"){if(this.inBezierVicinity(V,U,N.startX,N.startY,N.cp2x,N.cp2y,N.endX,N.endY,Math.pow(O[P]._private.style.width.value/2,2))&&(Math.pow(O[P]._private.style.width.value/2,2)+M>this.sqDistanceToQuadraticBezier(V,U,N.startX,N.startY,N.cp2x,N.cp2y,N.endX,N.endY))){I=true
}}}}if(!R.length||R[R.length-1]!=O[P]){if((b[O[P]._private.style["source-arrow-shape"].value].roughCollide(V,U,O[P]._private.rscratch.arrowStartX,O[P]._private.rscratch.arrowStartY,this.getArrowWidth(O[P]._private.style.width.value),this.getArrowHeight(O[P]._private.style.width.value),[O[P]._private.rscratch.arrowStartX-O[P].source()[0]._private.position.x,O[P]._private.rscratch.arrowStartY-O[P].source()[0]._private.position.y],0)&&b[O[P]._private.style["source-arrow-shape"].value].collide(V,U,O[P]._private.rscratch.arrowStartX,O[P]._private.rscratch.arrowStartY,this.getArrowWidth(O[P]._private.style.width.value),this.getArrowHeight(O[P]._private.style.width.value),[O[P]._private.rscratch.arrowStartX-O[P].source()[0]._private.position.x,O[P]._private.rscratch.arrowStartY-O[P].source()[0]._private.position.y],0))||(b[O[P]._private.style["target-arrow-shape"].value].roughCollide(V,U,O[P]._private.rscratch.arrowEndX,O[P]._private.rscratch.arrowEndY,this.getArrowWidth(O[P]._private.style.width.value),this.getArrowHeight(O[P]._private.style.width.value),[O[P]._private.rscratch.arrowEndX-O[P].target()[0]._private.position.x,O[P]._private.rscratch.arrowEndY-O[P].target()[0]._private.position.y],0)&&b[O[P]._private.style["target-arrow-shape"].value].collide(V,U,O[P]._private.rscratch.arrowEndX,O[P]._private.rscratch.arrowEndY,this.getArrowWidth(O[P]._private.style.width.value),this.getArrowHeight(O[P]._private.style.width.value),[O[P]._private.rscratch.arrowEndX-O[P].target()[0]._private.position.x,O[P]._private.rscratch.arrowEndY-O[P].target()[0]._private.position.y],0))){I=true
}}if(I){if(J){var H=Q.cy.getElementById(O[P]._private.data.source);var S=Q.cy.getElementById(O[P]._private.data.target);if(O[P]._private.style.opacity.value!=0&&O[P]._private.style.visibility.value=="visible"&&H._private.style.opacity.value!=0&&H._private.style.visibility.value=="visible"&&S._private.style.opacity.value!=0&&S._private.style.visibility.value=="visible"){R.push(O[P])}}else{R.push(O[P])}}}R.sort(C);if(R.length>0){return R[R.length-1]}else{return null}};z.prototype.getAllInBox=function(J,T,H,S){var O=this.data;
var I=this.getCachedNodes();var M=this.getCachedEdges();var P=[];var R=Math.min(J,H);var L=Math.max(J,H);var U=Math.min(T,S);var Q=Math.max(T,S);J=R;H=L;T=U;S=Q;var K;for(var N=0;N<I.length;N++){if(q[this.getNodeShape(I[N])].intersectBox(J,T,H,S,this.getNodeWidth(I[N]),this.getNodeHeight(I[N]),I[N]._private.position.x,I[N]._private.position.y,I[N]._private.style["border-width"].value/2)){P.push(I[N])}}for(var N=0;N<M.length;N++){if(M[N]._private.rscratch.edgeType=="self"){if((K=this.boxInBezierVicinity(J,T,H,S,M[N]._private.rscratch.startX,M[N]._private.rscratch.startY,M[N]._private.rscratch.cp2ax,M[N]._private.rscratch.cp2ay,M[N]._private.rscratch.endX,M[N]._private.rscratch.endY,M[N]._private.style.width.value))&&(K==2||(K==1&&this.checkBezierInBox(J,T,H,S,M[N]._private.rscratch.startX,M[N]._private.rscratch.startY,M[N]._private.rscratch.cp2ax,M[N]._private.rscratch.cp2ay,M[N]._private.rscratch.endX,M[N]._private.rscratch.endY,M[N]._private.style.width.value)))||(K=this.boxInBezierVicinity(J,T,H,S,M[N]._private.rscratch.startX,M[N]._private.rscratch.startY,M[N]._private.rscratch.cp2cx,M[N]._private.rscratch.cp2cy,M[N]._private.rscratch.endX,M[N]._private.rscratch.endY,M[N]._private.style.width.value))&&(K==2||(K==1&&this.checkBezierInBox(J,T,H,S,M[N]._private.rscratch.startX,M[N]._private.rscratch.startY,M[N]._private.rscratch.cp2cx,M[N]._private.rscratch.cp2cy,M[N]._private.rscratch.endX,M[N]._private.rscratch.endY,M[N]._private.style.width.value)))){P.push(M[N])
}}if(M[N]._private.rscratch.edgeType=="bezier"&&(K=this.boxInBezierVicinity(J,T,H,S,M[N]._private.rscratch.startX,M[N]._private.rscratch.startY,M[N]._private.rscratch.cp2x,M[N]._private.rscratch.cp2y,M[N]._private.rscratch.endX,M[N]._private.rscratch.endY,M[N]._private.style.width.value))&&(K==2||(K==1&&this.checkBezierInBox(J,T,H,S,M[N]._private.rscratch.startX,M[N]._private.rscratch.startY,M[N]._private.rscratch.cp2x,M[N]._private.rscratch.cp2y,M[N]._private.rscratch.endX,M[N]._private.rscratch.endY,M[N]._private.style.width.value)))){P.push(M[N])
}if(M[N]._private.rscratch.edgeType=="straight"&&(K=this.boxInBezierVicinity(J,T,H,S,M[N]._private.rscratch.startX,M[N]._private.rscratch.startY,M[N]._private.rscratch.startX*0.5+M[N]._private.rscratch.endX*0.5,M[N]._private.rscratch.startY*0.5+M[N]._private.rscratch.endY*0.5,M[N]._private.rscratch.endX,M[N]._private.rscratch.endY,M[N]._private.style.width.value))&&(K==2||(K==1&&this.checkStraightEdgeInBox(J,T,H,S,M[N]._private.rscratch.startX,M[N]._private.rscratch.startY,M[N]._private.rscratch.endX,M[N]._private.rscratch.endY,M[N]._private.style.width.value)))){P.push(M[N])
}}return P};z.prototype.updateAllCompounds=function(K){for(var H=K.length-1;H>=0;H--){if(K[H].isNode()&&(K[H]._private.style.width.value=="auto"||K[H]._private.style.height.value=="auto")&&K[H].children().length>0){var J=K[H];var I=this.calcCompoundBounds(J);J._private.position.x=I.x;J._private.position.y=I.y;J._private.autoWidth=I.width;J._private.autoHeight=I.height}}};z.prototype.calcCompoundBounds=function(N){var M=N.descendants().not(":removed");var H={x:N._private.position.x,y:N._private.position.y,width:N._private.autoWidth,height:N._private.autoHeight};
if(N._private.style.visibility.value!="visible"){return H}var I=[];for(var P=0;P<M.size();P++){if(M[P]._private.style.visibility.value=="visible"){I.push(M[P])}}if(I.length==0){return H}M=I;var J=this.borderValue(M,"left");var Q=this.borderValue(M,"right");var O=this.borderValue(M,"top");var L=this.borderValue(M,"bottom");var T=this.getNodePadding(N);var S=(J-T.left+Q+T.right)/2;var R=(O-T.top+L+T.bottom)/2;var K=(Q-J)+T.left+T.right;var U=(L-O)+T.top+T.bottom;H={x:S,y:R,width:K,height:U};return H
};z.prototype.borderValue=function(J,R){var N,I;var S=1/0,P=-1/0;var i=this;var Q=function(V){var U={};U.x=V._private.position.x;U.y=V._private.position.y;U.width=V.outerWidth();U.height=V.outerHeight();return U};var L=function(V){var W=String(V._private.style.content.value);var X=V._private.style["text-transform"].value;if(X=="none"){}else{if(X=="uppercase"){W=W.toUpperCase()}else{if(X=="lowercase"){W=W.toLowerCase()}}}var U=i.data.canvases[4].getContext("2d");return U.measureText(W).width};var T=function(Y){var W={};
var U=i.getNodeWidth(Y);var Z=i.getNodeHeight(Y);W.height=Y._private.style["font-size"].value;W.width=W.height;var X=Y._private.style["text-halign"].strValue;if(X=="left"){W.x=Y._private.position.x-U/2;W.left=W.x-W.width;W.right=W.x}else{if(X=="right"){W.x=Y._private.position.x+U/2;W.left=W.x;W.right=W.x+W.width}else{W.x=Y._private.position.x;W.left=W.x-W.width/2;W.right=W.x+W.width/2}}var V=Y._private.style["text-valign"].strValue;if(V=="top"){W.y=Y._private.position.y-Z/2;W.top=W.y-W.height;W.bottom=W.y
}else{if(V=="bottom"){W.y=Y._private.position.y+Z/2;W.top=W.y;W.bottom=W.y+W.height}else{W.y=Y._private.position.y;W.top=W.y-W.height/2;W.bottom=W.y+W.height/2}}return W};for(E=0;E<J.length;E++){N=Q(J[E]);I=T(J[E]);if(R=="left"){var H=Math.min(N.x-N.width/2,I.left);if(H<S){S=H}}else{if(R=="right"){var O=Math.max(N.x+N.width/2,I.right);if(O>P){P=O}}else{if(R=="top"){var M=Math.min(N.y-N.height/2,I.top);if(M<S){S=M}}else{if(R=="bottom"){var K=Math.max(N.y+N.height/2,I.bottom);if(K>P){P=K}}}}}}if((R=="left")||(R=="top")){return S
}else{return P}};z.prototype.getNodeWidth=function(i){if(i._private.style.width.value=="auto"||i._private.style.height.value=="auto"){return i._private.autoWidth}else{return i._private.style.width.value}};z.prototype.getNodeHeight=function(i){if(i._private.style.width.value=="auto"||i._private.style.height.value=="auto"){return i._private.autoHeight}else{return i._private.style.height.value}};z.prototype.getNodeShape=function(H){var i=H._private.style.shape.value;if(H.isParent()){if(i==="rectangle"||i==="roundrectangle"){return i
}else{return"rectangle"}}return i};z.prototype.getNodePadding=function(I){var K=I._private.style["padding-left"].value;var H=I._private.style["padding-right"].value;var J=I._private.style["padding-top"].value;var i=I._private.style["padding-bottom"].value;if(isNaN(K)){K=0}if(isNaN(H)){H=0}if(isNaN(J)){J=0}if(isNaN(i)){i=0}return{left:K,right:H,top:J,bottom:i}};z.prototype.matchCanvasSize=function(J){var O=this.data;var N=J.clientWidth;var I=J.clientHeight;var L,H=N,K=I;if("devicePixelRatio" in window){H*=devicePixelRatio;
K*=devicePixelRatio}for(var M=0;M<e;M++){L=O.canvases[M];if(L.width!==H||L.height!==K){L.width=H;L.height=K;L.style.width=N+"px";L.style.height=I+"px"}}for(var M=0;M<a;M++){L=O.bufferCanvases[M];if(L.width!==H||L.height!==K){L.width=H;L.height=K}}this.data.overlay.style.width=N+"px";this.data.overlay.style.height=I+"px"};var f=function(i){if(i._private.group=="nodes"){return i.parents().size()}else{if(i._private.group=="edges"){return Math.max(i.source()[0].parents().size(),i.target()[0].parents().size())
}else{return 0}}};z.prototype.getCachedZSortedEles=function(){var M=this.lastZOrderCachedNodes;var L=this.lastZOrderCachedEdges;var J=this.getCachedNodes();var I=this.getCachedEdges();var H=[];if(!M||!L||M!==J||L!==I){for(var K=0;K<J.length;K++){H.push(J[K])}for(var K=0;K<I.length;K++){H.push(I[K])}H.sort(C);this.cachedZSortedEles=H}else{H=this.cachedZSortedEles}this.lastZOrderCachedNodes=J;this.lastZOrderCachedEdges=I;return H};var C=function(I,H){var i=I._private.style["z-index"].value-H._private.style["z-index"].value;
var K=0;var J=0;if(I.cy().hasCompoundNodes()){K=f(I);J=f(H)}if(K-J===0){if(I._private.group==="nodes"&&H._private.group==="edges"){return 1}else{if(I._private.group==="edges"&&H._private.group==="nodes"){return -1}else{if(i===0){return I._private.index-H._private.index}else{return i}}}}else{return K-J}return 0};z.prototype.renderTo=function(i,H,I){this.redraw(i,true,H,I)};z.prototype.redraw=function(M,K,Q,I){var i=this;if(this.averageRedrawTime===undefined){this.averageRedrawTime=0}var J=1000/60;
var P=1000;var N=this.averageRedrawTime;N=Math.max(J,N);N=Math.min(N,P);if(this.lastDrawTime===undefined){this.lastDrawTime=0}var O=+new Date;var H=O-this.lastDrawTime;var L=H>=N;if(!M){if(!L){clearTimeout(this.redrawTimeout);this.redrawTimeout=setTimeout(function(){i.redraw()},N);return}this.lastDrawTime=O}setTimeout(function(){var ai=O;var ad=100;var V=i.data.cy;var ar=i.data;var al=i.getCachedNodes();var U=i.getCachedEdges();i.matchCanvasSize(ar.container);var R=V.zoom();var ac=Q!==undefined?Q:R;
var ak=V.pan();var ao={x:ak.x,y:ak.y};if(I){ao=I}if("devicePixelRatio" in window){ac*=devicePixelRatio;ao.x*=devicePixelRatio;ao.y*=devicePixelRatio}var ah=[];for(var am=0;am<al.length;am++){ah.push(al[am])}for(var am=0;am<U.length;am++){ah.push(U[am])}if(ar.canvasNeedsRedraw[d]||ar.canvasNeedsRedraw[G]||K){if(i.hideEdgesOnViewport&&(i.pinching||i.hoverData.dragging||i.data.wheel||i.swipePanning)){}else{i.findEdgeControlPoints(U)}var ah=i.getCachedZSortedEles();if(V.hasCompoundNodes()){i.updateAllCompounds(ah)
}}var aa;var X;var T;if(ar.canvasNeedsRedraw[G]||K){if(!aa||!X){aa=[];X=[];for(var ae=0;ae<ah.length;ae++){T=ah[ae];if(T._private.rscratch.inDragLayer){aa.push(T)}else{X.push(T)}}}var W=M||ar.canvases[G].getContext("2d");W.setTransform(1,0,0,1,0,0);W.clearRect(0,0,W.canvas.width,W.canvas.height);if(!K){W.translate(ao.x,ao.y);W.scale(ac,ac)}if(I){W.translate(I.x,I.y)}if(Q){W.scale(Q,Q)}for(var ae=0;ae<X.length;ae++){T=X[ae];if(T._private.group=="nodes"){i.drawNode(W,T)}else{if(T._private.group=="edges"){i.drawEdge(W,T)
}}}for(var ae=0;ae<X.length;ae++){T=X[ae];if(T._private.group=="nodes"){i.drawNodeText(W,T)}else{if(T._private.group=="edges"){i.drawEdgeText(W,T)}}if(T._private.group=="nodes"){i.drawNode(W,T,true)}else{if(T._private.group=="edges"){i.drawEdge(W,T,true)}}}if(!K){ar.canvasNeedsRedraw[G]=false;ar.canvasRedrawReason[G]=[]}}if(ar.canvasNeedsRedraw[d]||K){if(!aa||!X){aa=[];X=[];for(var ae=0;ae<ah.length;ae++){T=ah[ae];if(T._private.rscratch.inDragLayer){aa.push(T)}else{X.push(T)}}}var W=M||ar.canvases[d].getContext("2d");
if(!K){W.setTransform(1,0,0,1,0,0);W.clearRect(0,0,W.canvas.width,W.canvas.height);W.translate(ao.x,ao.y);W.scale(ac,ac)}if(I){W.translate(I.x,I.y)}if(Q){W.scale(Q,Q)}var T;for(var ae=0;ae<aa.length;ae++){T=aa[ae];if(T._private.group=="nodes"){i.drawNode(W,T)}else{if(T._private.group=="edges"){i.drawEdge(W,T)}}}for(var ae=0;ae<aa.length;ae++){T=aa[ae];if(T._private.group=="nodes"){i.drawNodeText(W,T)}else{if(T._private.group=="edges"){i.drawEdgeText(W,T)}}if(T._private.group=="nodes"){i.drawNode(W,T,true)
}else{if(T._private.group=="edges"){i.drawEdge(W,T,true)}}}if(!K){ar.canvasNeedsRedraw[d]=false;ar.canvasRedrawReason[d]=[]}}if(ar.canvasNeedsRedraw[D]){var W=M||ar.canvases[D].getContext("2d");if(!K){W.setTransform(1,0,0,1,0,0);W.clearRect(0,0,W.canvas.width,W.canvas.height);W.translate(ao.x,ao.y);W.scale(ac,ac)}if(I){W.translate(I.x,I.y)}if(Q){W.scale(Q,Q)}var S=V.style()._private.coreStyle;if(ar.select[4]==1){var R=ar.cy.zoom();var aq=S["selection-box-border-width"].value/R;W.lineWidth=aq;W.fillStyle="rgba("+S["selection-box-color"].value[0]+","+S["selection-box-color"].value[1]+","+S["selection-box-color"].value[2]+","+S["selection-box-opacity"].value+")";
W.fillRect(ar.select[0],ar.select[1],ar.select[2]-ar.select[0],ar.select[3]-ar.select[1]);if(aq>0){W.strokeStyle="rgba("+S["selection-box-border-color"].value[0]+","+S["selection-box-border-color"].value[1]+","+S["selection-box-border-color"].value[2]+","+S["selection-box-opacity"].value+")";W.strokeRect(ar.select[0],ar.select[1],ar.select[2]-ar.select[0],ar.select[3]-ar.select[1])}}if(ar.bgActivePosistion){var R=ar.cy.zoom();var ab=ar.bgActivePosistion;W.fillStyle="rgba("+S["active-bg-color"].value[0]+","+S["active-bg-color"].value[1]+","+S["active-bg-color"].value[2]+","+S["active-bg-opacity"].value+")";
W.beginPath();W.arc(ab.x,ab.y,S["active-bg-size"].pxValue/R,0,2*Math.PI);W.fill()}if(!K){ar.canvasNeedsRedraw[D]=false;ar.canvasRedrawReason[D]=[]}}if(i.options.showOverlay){var W=ar.canvases[u].getContext("2d");W.lineJoin="round";W.font="14px helvetica";W.strokeStyle="#fff";W.lineWidth="4";W.fillStyle="#666";W.textAlign="right";var ag="cytoscape.js";var af=W.canvas.width;var an=W.canvas.height;var aj=4;var ap=W.measureText(ag).width;var Z=14;W.clearRect(0,0,af,an);W.strokeText(ag,af-aj,an-aj);W.fillText(ag,af-aj,an-aj);
ar.overlayDrawn=true}var Y=+new Date;if(i.averageRedrawTime===undefined){i.averageRedrawTime=Y-ai}i.averageRedrawTime=i.averageRedrawTime/2+(Y-ai)/2;if(!M&&!i.initrender){i.initrender=true;V.trigger("initrender")}},0)};var l={};var h=30*300;z.prototype.getCachedImage=function(H,I){if(l[H]&&l[H].image){l[H].keepTime=h;return l[H].image}var i=l[H];if(i==undefined){l[H]=new Object();l[H].image=new Image();l[H].image.onload=I;l[H].image.src=H;l[H].keepTime=h;i=l[H]}return i.image};z.prototype.swapCachedImage=function(H){if(l[H]){if(l[H].image&&l[H].image.complete){var I=l[H].image;
var i=document.createElement("canvas");i.width=I.width;i.height=I.height;i.getContext("2d").drawImage(I,0,0);l[H].image=i;l[H].swappedWithCanvas=true;return i}else{return null}}else{return null}};z.prototype.updateImageCaches=function(){for(var i in l){if(l[i].keepTime<=0){if(l[i].image!=undefined){l[i].image.src=undefined;l[i].image=undefined}l[i]=undefined}else{l[i]-=1}}};z.prototype.drawImage=function(i,N,M,K,J,O,I){I.widthScale=0.5;I.heightScale=0.5;I.rotate=O;var L;var H;canvas.drawImage(I,N,M)
};z.prototype.drawEdge=function(I,K,L){if(this.hideEdgesOnViewport&&(this.dragData.didDrag||this.pinching||this.hoverData.dragging||this.data.wheel||this.swipePanning)){return}var M,Q;M=K.source()[0];Q=K.target()[0];if(K._private.style.visibility.value!="visible"||M._private.style.visibility.value!="visible"||Q._private.style.visibility.value!="visible"){return}var U=K._private.style["overlay-padding"].value;var S=K._private.style["overlay-opacity"].value;var T=K._private.style["overlay-color"].value;
if(L){I.strokeStyle="rgba( "+T[0]+", "+T[1]+", "+T[2]+", "+S+" )";I.lineCap="round";if(K._private.rscratch.edgeType=="self"){I.lineCap="butt"}}else{I.strokeStyle="rgba("+K._private.style["line-color"].value[0]+","+K._private.style["line-color"].value[1]+","+K._private.style["line-color"].value[2]+","+K._private.style.opacity.value+")"}if(K._private.style.width.value<=0){return}var R=K._private.style.width.value+(L?2*U:0);var O=L?"solid":K._private.style["line-style"].value;I.lineWidth=R;this.findEndpoints(K);
if(K._private.rscratch.edgeType=="self"){var i=K._private.rscratch;this.drawStyledEdge(K,I,[i.startX,i.startY,i.cp2ax,i.cp2ay,i.selfEdgeMidX,i.selfEdgeMidY],O,R);this.drawStyledEdge(K,I,[i.selfEdgeMidX,i.selfEdgeMidY,i.cp2cx,i.cp2cy,i.endX,i.endY],O,R)}else{if(K._private.rscratch.edgeType=="straight"){var J=Q._private.position.x-M._private.position.x;var H=Q._private.position.y-M._private.position.y;var P=K._private.rscratch.endX-K._private.rscratch.startX;var N=K._private.rscratch.endY-K._private.rscratch.startY;
if(J*P+H*N<0){K._private.rscratch.straightEdgeTooShort=true}else{var i=K._private.rscratch;this.drawStyledEdge(K,I,[i.startX,i.startY,i.endX,i.endY],O,R);K._private.rscratch.straightEdgeTooShort=false}}else{var i=K._private.rscratch;this.drawStyledEdge(K,I,[i.startX,i.startY,i.cp2x,i.cp2y,i.endX,i.endY],O,R)}}if(K._private.rscratch.noArrowPlacement!==true&&K._private.rscratch.startX!==undefined){this.drawArrowheads(I,K,L)}};var t=function(P,L,J){var I=Math.sqrt(Math.pow(P[4]-P[0],2)+Math.pow(P[5]-P[1],2));
I+=Math.sqrt(Math.pow((P[4]+P[0])/2-P[2],2)+Math.pow((P[5]+P[1])/2-P[3],2));var O=Math.ceil(I/L);var H=I/L;var M;if(O>0){M=new Array(O*2)}else{return null}for(var K=0;K<O;K++){var N=K/O;M[K*2]=P[0]*(1-N)*(1-N)+2*(P[2])*(1-N)*N+P[4]*(N)*(N);M[K*2+1]=P[1]*(1-N)*(1-N)+2*(P[3])*(1-N)*N+P[5]*(N)*(N)}return M};var s=function(P,L,J){var I=Math.sqrt(Math.pow(P[2]-P[0],2)+Math.pow(P[3]-P[1],2));var O=Math.ceil(I/L);var M;if(O>0){M=new Array(O*2)}else{return null}var H=[P[2]-P[0],P[3]-P[1]];for(var K=0;K<O;
K++){var N=K/O;M[K*2]=H[0]*N+P[0];M[K*2+1]=H[1]*N+P[1]}return M};var r=function(I,i,H){pt1=_genpts(I,i);pt2=_genpts(I,H)};z.prototype.createBuffer=function(H,I){var i=document.createElement("canvas");i.width=H;i.height=I;return[i,i.getContext("2d")]};z.prototype.drawStyledEdge=function(O,K,ab,L,U){var J=this.data.cy;var I=J.zoom();function aa(ae,ad,ac,i){return(1-i)*(1-i)*ae+2*(1-i)*i*ad+i*i*ac}if(O._private.rstyle.bezierPts===undefined){O._private.rstyle.bezierPts=[]}var W=O._private.rstyle.bezierPts.length;
if(O.isLoop()){if(W>=12){O._private.rstyle.bezierPts=[]}else{}}else{O._private.rstyle.bezierPts=[]}var R=O._private.rstyle.bezierPts;if(ab.length===6){R.push({x:aa(ab[0],ab[2],ab[4],0.05),y:aa(ab[1],ab[3],ab[5],0.05)});R.push({x:aa(ab[0],ab[2],ab[4],0.25),y:aa(ab[1],ab[3],ab[5],0.25)});R.push({x:aa(ab[0],ab[2],ab[4],0.35),y:aa(ab[1],ab[3],ab[5],0.35)});R.push({x:aa(ab[0],ab[2],ab[4],0.65),y:aa(ab[1],ab[3],ab[5],0.65)});R.push({x:aa(ab[0],ab[2],ab[4],0.75),y:aa(ab[1],ab[3],ab[5],0.75)});R.push({x:aa(ab[0],ab[2],ab[4],0.95),y:aa(ab[1],ab[3],ab[5],0.95)})
}if(L=="solid"){K.beginPath();K.moveTo(ab[0],ab[1]);if(ab.length==3*2){K.quadraticCurveTo(ab[2],ab[3],ab[4],ab[5])}else{K.lineTo(ab[2],ab[3])}K.stroke()}else{if(L=="dotted"){var T;if(ab.length==3*2){T=t(ab,16,true)}else{T=s(ab,16,true)}if(!T){return}var N=Math.max(U*1.6,3.4)*I;var M=N*2,Q=N*2;M=Math.max(M,1);Q=Math.max(Q,1);var X=this.createBuffer(M,Q);var V=X[1];V.setTransform(1,0,0,1,0,0);V.clearRect(0,0,M,Q);V.fillStyle=K.strokeStyle;V.beginPath();V.arc(M/2,Q/2,N*0.5,0,Math.PI*2,false);V.fill();
K.beginPath();for(var Y=0;Y<T.length/2;Y++){K.drawImage(X[0],T[Y*2]-M/2/I,T[Y*2+1]-Q/2/I,M/I,Q/I)}}else{if(L=="dashed"){var T;if(ab.length==3*2){T=t(ab,14,true)}else{T=s(ab,14,true)}if(!T){return}var M=U*2*I;var Q=7.8*I;M=Math.max(M,1);Q=Math.max(Q,1);var X=this.createBuffer(M,Q);var V=X[1];V.setTransform(1,0,0,1,0,0);V.clearRect(0,0,M,Q);if(K.strokeStyle){V.strokeStyle=K.strokeStyle}V.lineWidth=U*J.zoom();V.beginPath();V.moveTo(M/2,Q*0.2);V.lineTo(M/2,Q*0.8);V.stroke();var H=false;var P,Z;if(ab.length==2*2){P=[ab[2]-ab[0],ab[3]-T[1]];
Z=Math.acos((P[0]*0+P[1]*-1)/Math.sqrt(P[0]*P[0]+P[1]*P[1]));if(P[0]<0){Z=-Z+2*Math.PI}}else{if(ab.length==3*2){H=true}}for(var Y=0;Y<T.length/2;Y++){var S=Y/(Math.max(T.length/2-1,1));if(H){P=[2*(1-S)*(ab[2]-ab[0])+2*S*(ab[4]-ab[2]),2*(1-S)*(ab[3]-ab[1])+2*S*(ab[5]-ab[3])];Z=Math.acos((P[0]*0+P[1]*-1)/Math.sqrt(P[0]*P[0]+P[1]*P[1]));if(P[0]<0){Z=-Z+2*Math.PI}}K.translate(T[Y*2],T[Y*2+1]);K.rotate(Z);K.translate(-M/2/I,-Q/2/I);K.drawImage(X[0],0,0,M/I,Q/I);K.translate(M/2/I,Q/2/I);K.rotate(-Z);K.translate(-T[Y*2],-T[Y*2+1])
}}else{this.drawStyledEdge(O,K,ab,"solid",U)}}}};z.prototype.drawEdgeText=function(I,J){if(this.hideEdgesOnViewport&&(this.dragData.didDrag||this.pinching||this.hoverData.dragging||this.data.wheel||this.swipePanning)){return}if(J._private.style.visibility.value!="visible"){return}var L=J._private.style["font-size"].pxValue*J.cy().zoom();var H=J._private.style["min-zoomed-font-size"].pxValue;if(L<H){return}I.textAlign="center";I.textBaseline="middle";var M,K;var O,N;if(J._private.rscratch.edgeType=="self"){O=J._private.rscratch.selfEdgeMidX;
N=J._private.rscratch.selfEdgeMidY}else{if(J._private.rscratch.edgeType=="straight"){O=(J._private.rscratch.startX+J._private.rscratch.endX)/2;N=(J._private.rscratch.startY+J._private.rscratch.endY)/2}else{if(J._private.rscratch.edgeType=="bezier"){O=0.25*J._private.rscratch.startX+2*0.5*0.5*J._private.rscratch.cp2x+(0.5*0.5)*J._private.rscratch.endX;N=Math.pow(1-0.5,2)*J._private.rscratch.startY+2*(1-0.5)*0.5*J._private.rscratch.cp2y+(0.5*0.5)*J._private.rscratch.endY}}}M=O;K=N;var i=J._private.rstyle;
i.labelX=M;i.labelY=K;this.drawText(I,J,M,K)};z.prototype.drawNode=function(K,M,L){var U,J;if(M._private.style.visibility.value!="visible"){return}var W=1;var S=M.parents();for(var O=0;O<S.length;O++){var T=S[O];var P=T._private.style.opacity.value;W=P*W;if(P===0){return}}U=this.getNodeWidth(M);J=this.getNodeHeight(M);K.lineWidth=M._private.style["border-width"].pxValue;if(L===undefined||!L){K.fillStyle="rgba("+M._private.style["background-color"].value[0]+","+M._private.style["background-color"].value[1]+","+M._private.style["background-color"].value[2]+","+(M._private.style["background-opacity"].value*M._private.style.opacity.value*W)+")";
K.strokeStyle="rgba("+M._private.style["border-color"].value[0]+","+M._private.style["border-color"].value[1]+","+M._private.style["border-color"].value[2]+","+(M._private.style["border-opacity"].value*M._private.style.opacity.value*W)+")";var I=M._private.style["background-image"].value[2]||M._private.style["background-image"].value[1];if(I!=undefined){var H=this;var N=this.getCachedImage(I,function(){H.data.canvasNeedsRedraw[G]=true;H.data.canvasRedrawReason[G].push("image finished load");H.data.canvasNeedsRedraw[d]=true;
H.data.canvasRedrawReason[d].push("image finished load");H.swapCachedImage(I);H.redraw()});if(N.complete==false){q[H.getNodeShape(M)].drawPath(K,M._private.position.x,M._private.position.y,U,J);K.stroke();K.fillStyle="#555555";K.fill()}else{this.drawInscribedImage(K,N,M)}}else{q[this.getNodeShape(M)].draw(K,M._private.position.x,M._private.position.y,U,J)}if(M._private.style["border-width"].value>0){K.stroke()}}else{var V=M._private.style["overlay-padding"].value;var Q=M._private.style["overlay-opacity"].value;
var R=M._private.style["overlay-color"].value;if(Q>0){K.fillStyle="rgba( "+R[0]+", "+R[1]+", "+R[2]+", "+Q+" )";q[this.getNodeShape(M)].draw(K,M._private.position.x,M._private.position.y,U+V*2,J+V*2)}}};z.prototype.drawInscribedImage=function(I,N,L){var i=this;var P=this.data.cy._private.zoom;var K=L._private.position.x;var J=L._private.position.y;var O=this.getNodeWidth(L);var H=this.getNodeHeight(L);I.save();q[i.getNodeShape(L)].drawPath(I,K,J,O,H);I.clip();var M=[N.width,N.height];I.drawImage(N,K-M[0]/2,J-M[1]/2,M[0],M[1]);
I.restore();if(L._private.style["border-width"].value>0){I.stroke()}};z.prototype.drawNodeText=function(I,J){if(J._private.style.visibility.value!="visible"){return}var M=J._private.style["font-size"].pxValue*J.cy().zoom();var i=J._private.style["min-zoomed-font-size"].pxValue;if(M<i){return}var N,L;var P=this.getNodeWidth(J);var H=this.getNodeHeight(J);var K=J._private.style["text-halign"].strValue;if(K=="left"){I.textAlign="right";N=J._private.position.x-P/2}else{if(K=="right"){I.textAlign="left";
N=J._private.position.x+P/2}else{if(K=="center"){I.textAlign="center";N=J._private.position.x}else{I.textAlign="center";N=J._private.position.x}}}var O=J._private.style["text-valign"].strValue;if(O=="top"){I.textBaseline="bottom";L=J._private.position.y-H/2}else{if(O=="bottom"){I.textBaseline="top";L=J._private.position.y+H/2}else{if(O=="middle"||O=="center"){I.textBaseline="middle";L=J._private.position.y}else{I.textBaseline="middle";L=J._private.position.y}}}this.drawText(I,J,N,L)};z.prototype.drawText=function(H,L,O,N){var X=1;
var T=L.parents();for(var M=0;M<T.length;M++){var U=T[M];var R=U._private.style.opacity.value;X=R*X;if(R===0){return}}var S=L._private.style["font-style"].strValue;var K=L._private.style["font-size"].value+"px";var W=L._private.style["font-family"].strValue;var Q=L._private.style["font-variant"].strValue;var I=L._private.style["font-weight"].strValue;H.font=S+" "+I+" "+K+" "+W;var V=String(L._private.style.content.value);var J=L._private.style["text-transform"].value;if(J=="none"){}else{if(J=="uppercase"){V=V.toUpperCase()
}else{if(J=="lowercase"){V=V.toLowerCase()}}}H.lineJoin="round";H.fillStyle="rgba("+L._private.style.color.value[0]+","+L._private.style.color.value[1]+","+L._private.style.color.value[2]+","+(L._private.style["text-opacity"].value*L._private.style.opacity.value*X)+")";H.strokeStyle="rgba("+L._private.style["text-outline-color"].value[0]+","+L._private.style["text-outline-color"].value[1]+","+L._private.style["text-outline-color"].value[2]+","+(L._private.style["text-opacity"].value*L._private.style.opacity.value*X)+")";
if(V!=undefined){var P=2*L._private.style["text-outline-width"].value;if(P>0){H.lineWidth=P;H.strokeText(V,O,N)}if(isNaN(O)){O=0}if(isNaN(N)){N=0}H.fillText(""+V,O,N);L._private.rstyle.labelWidth=H.measureText(V).width}};z.prototype.drawBackground=function(I,H,i,J,K){};z.prototype.findEdgeControlPoints=function(Z){var H={};var ac=this.data.cy;var M=[];var V;for(var aq=0;aq<Z.length;aq++){V=Z[aq]._private.data.source>Z[aq]._private.data.target?Z[aq]._private.data.target+"-"+Z[aq]._private.data.source:Z[aq]._private.data.source+"-"+Z[aq]._private.data.target;
if(H[V]==undefined){H[V]=[]}H[V].push(Z[aq]);M.push(V)}var ad,aj;for(var al=0;al<M.length;al++){V=M[al];ad=ac.getElementById(H[V][0]._private.data.source);aj=ac.getElementById(H[V][0]._private.data.target);var ab=(ad._private.position.x+aj._private.position.x)/2;var aa=(ad._private.position.y+aj._private.position.y)/2;var U,T;if(H[V].length>1){U=aj._private.position.y-ad._private.position.y;T=ad._private.position.x-aj._private.position.x;var S=Math.sqrt(U*U+T*T);U/=S;T/=S}var R;for(var aq=0;aq<H[V].length;
aq++){R=H[V][aq];var O=R._private.rscratch.lastEdgeIndex;var N=aq;var J=R._private.rscratch.lastNumEdges;var I=H[V].length;var ai=R._private.rscratch.lastSrcCtlPtX;var ah=ad._private.position.x;var Y=R._private.rscratch.lastSrcCtlPtY;var X=ad._private.position.y;var at=R._private.rscratch.lastSrcCtlPtW;var ar=ad.outerWidth();var an=R._private.rscratch.lastSrcCtlPtH;var am=ad.outerHeight();var ap=R._private.rscratch.lastTgtCtlPtX;var ao=aj._private.position.x;var af=R._private.rscratch.lastTgtCtlPtY;
var ae=aj._private.position.y;var Q=R._private.rscratch.lastTgtCtlPtW;var P=aj.outerWidth();var L=R._private.rscratch.lastTgtCtlPtH;var K=aj.outerHeight();if(ai===ah&&Y===X&&at===ar&&an===am&&ap===ao&&af===ae&&Q===P&&L===K&&O===N&&J===I){continue}else{var ag=R._private.rscratch;ag.lastSrcCtlPtX=ah;ag.lastSrcCtlPtY=X;ag.lastSrcCtlPtW=ar;ag.lastSrcCtlPtH=am;ag.lastTgtCtlPtX=ao;ag.lastTgtCtlPtY=ae;ag.lastTgtCtlPtW=P;ag.lastTgtCtlPtH=K;ag.lastEdgeIndex=N;ag.lastNumEdges=I}if(ad._private.data.id==aj._private.data.id){var ak=R._private.style["control-point-step-size"].pxValue;
R._private.rscratch.edgeType="self";R._private.rscratch.cp2ax=ad._private.position.x;R._private.rscratch.cp2ay=ad._private.position.y-(1+Math.pow(this.getNodeHeight(ad),1.12)/100)*ak*(aq/3+1);R._private.rscratch.cp2cx=ad._private.position.x-(1+Math.pow(this.getNodeWidth(ad),1.12)/100)*ak*(aq/3+1);R._private.rscratch.cp2cy=ad._private.position.y;R._private.rscratch.selfEdgeMidX=(R._private.rscratch.cp2ax+R._private.rscratch.cp2cx)/2;R._private.rscratch.selfEdgeMidY=(R._private.rscratch.cp2ay+R._private.rscratch.cp2cy)/2
}else{if(H[V].length%2==1&&aq==Math.floor(H[V].length/2)){R._private.rscratch.edgeType="straight"}else{var ak=R._private.style["control-point-step-size"].value;var W=(0.5-H[V].length/2+aq)*ak;R._private.rscratch.edgeType="bezier";R._private.rscratch.cp2x=ab+U*W;R._private.rscratch.cp2y=aa+T*W}}}}return H};z.prototype.findEndpoints=function(J){var L;var i=J.source()[0];var P=J.target()[0];var U=Math.max(this.getNodeWidth(i),this.getNodeHeight(i));var K=Math.max(this.getNodeWidth(P),this.getNodeHeight(P));
U=0;K/=2;var I=[J.source().position().x,J.source().position().y];var M=[J.target().position().x,J.target().position().y];if(J._private.rscratch.edgeType=="self"){var R=[J._private.rscratch.cp2cx,J._private.rscratch.cp2cy];L=q[this.getNodeShape(P)].intersectLine(P._private.position.x,P._private.position.y,this.getNodeWidth(P),this.getNodeHeight(P),R[0],R[1],P._private.style["border-width"].value/2);var H=this.shortenIntersection(L,R,b[J._private.style["target-arrow-shape"].value].spacing(J));var Q=this.shortenIntersection(L,R,b[J._private.style["target-arrow-shape"].value].gap(J));
J._private.rscratch.endX=Q[0];J._private.rscratch.endY=Q[1];J._private.rscratch.arrowEndX=H[0];J._private.rscratch.arrowEndY=H[1];var R=[J._private.rscratch.cp2ax,J._private.rscratch.cp2ay];L=q[this.getNodeShape(i)].intersectLine(i._private.position.x,i._private.position.y,this.getNodeWidth(i),this.getNodeHeight(i),R[0],R[1],i._private.style["border-width"].value/2);var N=this.shortenIntersection(L,R,b[J._private.style["source-arrow-shape"].value].spacing(J));var O=this.shortenIntersection(L,R,b[J._private.style["source-arrow-shape"].value].gap(J));
J._private.rscratch.startX=O[0];J._private.rscratch.startY=O[1];J._private.rscratch.arrowStartX=N[0];J._private.rscratch.arrowStartY=N[1]}else{if(J._private.rscratch.edgeType=="straight"){L=q[this.getNodeShape(P)].intersectLine(P._private.position.x,P._private.position.y,this.getNodeWidth(P),this.getNodeHeight(P),i.position().x,i.position().y,P._private.style["border-width"].value/2);if(L.length==0){J._private.rscratch.noArrowPlacement=true}else{J._private.rscratch.noArrowPlacement=false}var H=this.shortenIntersection(L,[i.position().x,i.position().y],b[J._private.style["target-arrow-shape"].value].spacing(J));
var Q=this.shortenIntersection(L,[i.position().x,i.position().y],b[J._private.style["target-arrow-shape"].value].gap(J));J._private.rscratch.endX=Q[0];J._private.rscratch.endY=Q[1];J._private.rscratch.arrowEndX=H[0];J._private.rscratch.arrowEndY=H[1];L=q[this.getNodeShape(i)].intersectLine(i._private.position.x,i._private.position.y,this.getNodeWidth(i),this.getNodeHeight(i),P.position().x,P.position().y,i._private.style["border-width"].value/2);if(L.length==0){J._private.rscratch.noArrowPlacement=true
}else{J._private.rscratch.noArrowPlacement=false}var N=this.shortenIntersection(L,[P.position().x,P.position().y],b[J._private.style["source-arrow-shape"].value].spacing(J));var O=this.shortenIntersection(L,[P.position().x,P.position().y],b[J._private.style["source-arrow-shape"].value].gap(J));J._private.rscratch.startX=O[0];J._private.rscratch.startY=O[1];J._private.rscratch.arrowStartX=N[0];J._private.rscratch.arrowStartY=N[1]}else{if(J._private.rscratch.edgeType=="bezier"){var R=[J._private.rscratch.cp2x,J._private.rscratch.cp2y];
var T=I[0]*0.25+M[0]*0.25+R[0]*0.5;var S=I[1]*0.25+M[1]*0.25+R[1]*0.5;L=q[this.getNodeShape(P)].intersectLine(P._private.position.x,P._private.position.y,this.getNodeWidth(P),this.getNodeHeight(P),R[0],R[1],P._private.style["border-width"].value/2);var H=this.shortenIntersection(L,R,b[J._private.style["target-arrow-shape"].value].spacing(J));var Q=this.shortenIntersection(L,R,b[J._private.style["target-arrow-shape"].value].gap(J));J._private.rscratch.endX=Q[0];J._private.rscratch.endY=Q[1];J._private.rscratch.arrowEndX=H[0];
J._private.rscratch.arrowEndY=H[1];L=q[this.getNodeShape(i)].intersectLine(i._private.position.x,i._private.position.y,this.getNodeWidth(i),this.getNodeHeight(i),R[0],R[1],i._private.style["border-width"].value/2);var N=this.shortenIntersection(L,R,b[J._private.style["source-arrow-shape"].value].spacing(J));var O=this.shortenIntersection(L,R,b[J._private.style["source-arrow-shape"].value].gap(J));J._private.rscratch.startX=O[0];J._private.rscratch.startY=O[1];J._private.rscratch.arrowStartX=N[0];
J._private.rscratch.arrowStartY=N[1]}else{if(J._private.rscratch.isArcEdge){return}}}}};z.prototype.findEdges=function(L){var I=this.getCachedEdges();var K={};var H=[];for(var J=0;J<L.length;J++){K[L[J]._private.data.id]=L[J]}for(var J=0;J<I.length;J++){if(K[I[J]._private.data.source]||K[I[J]._private.data.target]){H.push(I[J])}}return H};z.prototype.intersectLineEllipse=function(Q,P,M,L,J,H){var I=M-Q;var i=L-P;I/=J;i/=H;var N=Math.sqrt(I*I+i*i);var K=N-1;if(K<0){return[]}var O=K/N;return[(M-Q)*O+Q,(L-P)*O+P]
};z.prototype.dotProduct=function(H,i){if(H.length!=2||i.length!=2){throw"dot product: arguments are not vectors"}return(H[0]*i[0]+H[1]*i[1])};z.prototype.intersectLineCircle=function(S,H,R,i,N,M,I){var U=[R-S,i-H];var Q=[S,H];var W=[N,M];var T=[S-N,H-M];var Y=U[0]*U[0]+U[1]*U[1];var X=2*(T[0]*U[0]+T[1]*U[1]);var W=(T[0]*T[0]+T[1]*T[1])-I*I;var V=X*X-4*Y*W;if(V<0){return[]}t1=(-X+Math.sqrt(V))/(2*Y);t2=(-X-Math.sqrt(V))/(2*Y);var J=Math.min(t1,t2);var L=Math.max(t1,t2);var K=[];if(J>=0&&J<=1){K.push(J)
}if(L>=0&&L<=1){K.push(L)}if(K.length==0){return[]}var aa=K[0]*U[0]+S;var Z=K[0]*U[1]+H;if(K.length>1){if(K[0]==K[1]){return[aa,Z]}else{var P=K[1]*U[0]+S;var O=K[1]*U[1]+H;return[aa,Z,P,O]}}else{return[aa,Z]}};z.prototype.findCircleNearPoint=function(K,J,L,P,O){var H=P-K;var i=O-J;var I=Math.sqrt(H*H+i*i);var N=H/I;var M=i/I;return[K+N*L,J+M*L]};z.prototype.findMaxSqDistanceToOrigin=function(K){var H=0.000001;var J;for(var I=0;I<K.length/2;I++){J=K[I*2]*K[I*2]+K[I*2+1]*K[I*2+1];if(J>H){H=J}}return H
};z.prototype.finiteLinesIntersect=function(L,S,J,Q,H,P,T,N,R){var M=(T-H)*(S-P)-(N-P)*(L-H);var O=(J-L)*(S-P)-(Q-S)*(L-H);var K=(N-P)*(J-L)-(T-H)*(Q-S);if(K!=0){var I=M/K;var i=O/K;if(0<=I&&I<=1&&0<=i&&i<=1){return[L+I*(J-L),S+I*(Q-S)]}else{if(!R){return[]}else{return[L+I*(J-L),S+I*(Q-S)]}}}else{if(M==0||O==0){if([L,J,T].sort()[1]==T){return[T,N]}if([L,J,H].sort()[1]==H){return[H,P]}if([H,T,J].sort()[1]==J){return[J,Q]}return[]}else{return[]}}};z.prototype.boxIntersectEllipse=function(I,R,i,P,Q,H,U,M,K){if(i<I){var J=I;
I=i;i=J}if(P<R){var S=R;R=P;P=S}var T=[M-H/2-Q,K];var O=[M+H/2+Q,K];var L=[M,K-U/2-Q];var N=[M,K+U/2+Q];if(i<T[0]){return false}if(I>O[0]){return false}if(R>N[1]){return false}if(P<L[1]){return false}if(I<=O[0]&&O[0]<=i&&R<=O[1]&&O[1]<=P){return true}if(I<=T[0]&&T[0]<=i&&R<=T[1]&&T[1]<=P){return true}if(I<=L[0]&&L[0]<=i&&R<=L[1]&&L[1]<=P){return true}if(I<=N[0]&&N[0]<=i&&R<=N[1]&&N[1]<=P){return true}I=(I-M)/(H/2+Q);i=(i-M)/(H/2+Q);R=(R-K)/(U/2+Q);P=(P-K)/(U/2+Q);if(I*I+R*R<=1){return true}if(i*i+R*R<=1){return true
}if(i*i+P*P<=1){return true}if(I*I+P*P<=1){return true}return false};z.prototype.boxIntersectPolygon=function(ad,N,ab,K,P,W,V,T,R,ah,U){if(ab<ad){var ac=ad;ad=ab;ab=ac}if(K<N){var M=N;N=K;K=M}var S=new Array(P.length);var ae=Math.asin(ah[1]/(Math.sqrt(ah[0]*ah[0]+ah[1]*ah[1])));if(ah[0]<0){ae=ae+Math.PI/2}else{ae=-ae-Math.PI/2}var I=Math.cos(-ae);var H=Math.sin(-ae);for(var aa=0;aa<S.length/2;aa++){S[aa*2]=W/2*(P[aa*2]*I-P[aa*2+1]*H);S[aa*2+1]=V/2*(P[aa*2+1]*I+P[aa*2]*H);S[aa*2]+=T;S[aa*2+1]+=R}var L=S[0];
var Q=S[0];var J=S[1];var O=S[1];for(var aa=1;aa<S.length/2;aa++){if(S[aa*2]>Q){Q=S[aa*2]}if(S[aa*2]<L){L=S[aa*2]}if(S[aa*2+1]>O){O=S[aa*2+1]}if(S[aa*2+1]<J){J=S[aa*2+1]}}if(ab<L-U){return false}if(ad>Q+U){return false}if(K<J-U){return false}if(N>O+U){return false}var Z;if(U>0){var ai=B.expandPolygon(S,-U);Z=B.joinLines(ai)}else{Z=S}for(var aa=0;aa<S.length/2;aa++){if(ad<=S[aa*2]&&S[aa*2]<=ab){if(N<=S[aa*2+1]&&S[aa*2+1]<=K){return true}}}for(var aa=0;aa<Z.length/2;aa++){var Y=Z[aa*2];var X=Z[aa*2+1];
var ag;var af;if(aa<Z.length/2-1){ag=Z[(aa+1)*2];af=Z[(aa+1)*2+1]}else{ag=Z[0];af=Z[1]}if(B.finiteLinesIntersect(Y,X,ag,af,ad,N,ab,N,false).length>0){return true}if(B.finiteLinesIntersect(Y,X,ag,af,ad,K,ab,K,false).length>0){return true}if(B.finiteLinesIntersect(Y,X,ag,af,ad,N,ad,K,false).length>0){return true}if(B.finiteLinesIntersect(Y,X,ag,af,ab,N,ab,K,false).length>0){return true}}return false};z.prototype.polygonIntersectLine=function(N,M,H,K,I,Q,P,O){var Y=[];var L;var J=new Array(H.length);
for(var U=0;U<J.length/2;U++){J[U*2]=H[U*2]*Q+K;J[U*2+1]=H[U*2+1]*P+I}var T;if(O>0){var X=B.expandPolygon(J,-O);T=B.joinLines(X)}else{T=J}var S,R,W,V;for(var U=0;U<T.length/2;U++){S=T[U*2];R=T[U*2+1];if(U<T.length/2-1){W=T[(U+1)*2];V=T[(U+1)*2+1]}else{W=T[0];V=T[1]}L=this.finiteLinesIntersect(N,M,K,I,S,R,W,V);if(L.length!=0){Y.push(L[0],L[1])}}return Y};z.prototype.shortenIntersection=function(L,K,I){var i=[L[0]-K[0],L[1]-K[1]];var J=Math.sqrt(i[0]*i[0]+i[1]*i[1]);var H=(J-I)/J;if(H<0){return[]}else{return[K[0]+H*i[0],K[1]+H*i[1]]
}};b.arrow={_points:[-0.15,-0.3,0,0,0.15,-0.3],collide:function(M,J,I,H,i,O,K,L){var N=b.arrow._points;return c.pointInsidePolygon(M,J,N,I,H,i,O,K,L)},roughCollide:function(H,N,M,J,I,i,L,K){if(typeof(b.arrow._farthestPointSqDistance)=="undefined"){b.arrow._farthestPointSqDistance=c.findMaxSqDistanceToOrigin(b.arrow._points)}return c.checkInBoundingCircle(H,N,b.arrow._farthestPointSqDistance,0,I,i,M,J)},draw:function(I){var J=b.arrow._points;for(var H=0;H<J.length/2;H++){I.lineTo(J[H*2],J[H*2+1])}},spacing:function(i){return 0
},gap:function(i){return i._private.style.width.value*2}};b.triangle=b.arrow;b.none={collide:function(H,N,M,J,I,i,L,K){return false},roughCollide:function(H,N,M,J,I,i,L,K){return false},draw:function(i){},spacing:function(i){return 0},gap:function(i){return 0}};b.circle={_baseRadius:0.15,collide:function(P,M,J,I,i,S,N,O){if(i!=S){var H=Math.asin(N[1]/(Math.sqrt(N[0]*N[0]+N[1]*N[1])));var R=Math.cos(-H);var L=Math.sin(-H);var K=[P*R-M*L,M*R+P*L];var Q=(S+O)/(i+O);M/=Q;I/=Q;return(Math.pow(J-P,2)+Math.pow(I-M,2)<=Math.pow((i+O)*b.circle._baseRadius,2))
}else{return(Math.pow(J-P,2)+Math.pow(I-M,2)<=Math.pow((i+O)*b.circle._baseRadius,2))}},roughCollide:function(H,N,M,J,I,i,L,K){return true},draw:function(i){i.arc(0,0,b.circle._baseRadius,0,Math.PI*2,false)},spacing:function(i){return c.getArrowWidth(i._private.style.width.value)*b.circle._baseRadius},gap:function(i){return i._private.style.width.value*2}};b.inhibitor={_points:[-0.25,0,-0.25,-0.1,0.25,-0.1,0.25,0],collide:function(M,J,I,H,i,O,K,L){var N=b.inhibitor._points;return c.pointInsidePolygon(M,J,N,I,H,i,O,K,L)
},roughCollide:function(H,N,M,J,I,i,L,K){if(typeof(b.inhibitor._farthestPointSqDistance)=="undefined"){b.inhibitor._farthestPointSqDistance=c.findMaxSqDistanceToOrigin(b.inhibitor._points)}return c.checkInBoundingCircle(H,N,b.inhibitor._farthestPointSqDistance,0,I,i,M,J)},draw:function(I){var J=b.inhibitor._points;for(var H=0;H<J.length/2;H++){I.lineTo(J[H*2],J[H*2+1])}},spacing:function(i){return 4},gap:function(i){return 4}};b.square={_points:[-0.12,0,0.12,0,0.12,-0.24,-0.12,-0.24],collide:function(M,J,I,H,i,O,K,L){var N=b.square._points;
return c.pointInsidePolygon(M,J,N,I,H,i,O,K,L)},roughCollide:function(H,N,M,J,I,i,L,K){if(typeof(b.square._farthestPointSqDistance)=="undefined"){b.square._farthestPointSqDistance=c.findMaxSqDistanceToOrigin(b.square._points)}return c.checkInBoundingCircle(H,N,b.square._farthestPointSqDistance,0,I,i,M,J)},draw:function(I){var J=b.square._points;for(var H=0;H<J.length/2;H++){I.lineTo(J[H*2],J[H*2+1])}},spacing:function(i){return 0},gap:function(i){return i._private.style.width.value*2}};b.diamond={_points:[-0.14,-0.14,0,-0.28,0.14,-0.14,0,0],collide:function(M,J,I,H,i,O,K,L){var N=b.diamond._points;
return c.pointInsidePolygon(M,J,N,I,H,i,O,K,L)},roughCollide:function(H,N,M,J,I,i,L,K){if(typeof(b.diamond._farthestPointSqDistance)=="undefined"){b.diamond._farthestPointSqDistance=c.findMaxSqDistanceToOrigin(b.diamond._points)}return c.checkInBoundingCircle(H,N,b.diamond._farthestPointSqDistance,0,I,i,M,J)},draw:function(i){i.lineTo(-0.14,-0.14);i.lineTo(0,-0.28);i.lineTo(0.14,-0.14);i.lineTo(0,0)},spacing:function(i){return 0},gap:function(i){return i._private.style.width.value*2}};b.tee=b.inhibitor;
z.prototype.getArrowWidth=function(i){return Math.max(Math.pow(i*13.37,0.9),29)};z.prototype.getArrowHeight=function(i){return Math.max(Math.pow(i*13.37,0.9),29)};z.prototype.drawArrowheads=function(H,J,K){if(K){return}var I,i;var M=J._private.rscratch.arrowStartX;var L=J._private.rscratch.arrowStartY;I=M-J.source().position().x;i=L-J.source().position().y;H.fillStyle="rgba("+J._private.style["source-arrow-color"].value[0]+","+J._private.style["source-arrow-color"].value[1]+","+J._private.style["source-arrow-color"].value[2]+","+J._private.style.opacity.value+")";
H.lineWidth=J._private.style.width.value;this.drawArrowShape(H,J._private.style["source-arrow-shape"].value,M,L,I,i);var O=J._private.rscratch.arrowEndX;var N=J._private.rscratch.arrowEndY;I=O-J.target().position().x;i=N-J.target().position().y;H.fillStyle="rgba("+J._private.style["target-arrow-color"].value[0]+","+J._private.style["target-arrow-color"].value[1]+","+J._private.style["target-arrow-color"].value[2]+","+J._private.style.opacity.value+")";H.lineWidth=J._private.style.width.value;this.drawArrowShape(H,J._private.style["target-arrow-shape"].value,O,N,I,i)
};z.prototype.drawArrowShape=function(L,H,i,N,K,I){var M=Math.asin(I/(Math.sqrt(K*K+I*I)));if(K<0){M=M+Math.PI/2}else{M=-(Math.PI/2+M)}L.translate(i,N);L.moveTo(0,0);L.rotate(-M);var J=this.getArrowWidth(L.lineWidth);L.scale(J,J);L.beginPath();b[H].draw(L);L.closePath();L.fill();L.scale(1/J,1/J);L.rotate(M);L.translate(-i,-N)};var k=function(I,H){var N=1/I*2*Math.PI;var L=I%2==0?Math.PI/2+N/2:Math.PI/2;L+=H;var P=new Array(I*2);var J;for(var K=0;K<I;K++){J=K*N+L;P[2*K]=Math.cos(J);P[2*K+1]=Math.sin(-J)
}var R=0;var Q=0;for(var K=0;K<P.length/2;K++){if(Math.abs(P[2*K]>R)){R=Math.abs(P[2*K])}if(Math.abs(P[2*K+1]>Q)){Q=Math.abs(P[2*K+1])}}var M=0.0005;var O=Math.max(R,Q);for(var K=0;K<P.length/2;K++){if(O>M){P[2*K]*=(1/O);P[2*K+1]*=(1/O)}}return P};var B=c;q.ellipse={draw:function(H,K,J,I,i){q.ellipse.drawPath(H,K,J,I,i);H.fill()},drawPath:function(H,K,J,I,i){H.beginPath();H.translate(K,J);H.scale(I/2,i/2);H.arc(0,0,1,0,Math.PI*2*0.999,false);H.closePath();H.scale(2/I,2/i);H.translate(-K,-J)},intersectLine:function(L,K,J,I,H,N,M){var i=c.intersectLineEllipse(H,N,L,K,J/2+M,I/2+M);
return i},intersectBox:function(I,N,i,L,H,O,K,J,M){return z.prototype.boxIntersectEllipse(I,N,i,L,M,H,O,K,J)},checkPointRough:function(H,M,L,I,i,K,J){return true},checkPoint:function(H,M,L,I,i,K,J){H-=K;M-=J;H/=(I/2+L);M/=(i/2+L);return(Math.pow(H,2)+Math.pow(M,2)<=1)}};q.triangle={points:k(3,0),draw:function(H,K,J,I,i){B.drawPolygon(H,K,J,I,i,q.triangle.points)},drawPath:function(H,K,J,I,i){B.drawPolygonPath(H,K,J,I,i,q.triangle.points)},intersectLine:function(K,J,I,H,i,M,L){return B.polygonIntersectLine(i,M,q.triangle.points,K,J,I/2,H/2,L)
},intersectBox:function(I,N,i,L,H,P,K,J,M){var O=q.triangle.points;return B.boxIntersectPolygon(I,N,i,L,O,H,P,K,J,[0,-1],M)},checkPointRough:function(H,M,L,I,i,K,J){return B.checkInBoundingBox(H,M,q.triangle.points,L,I,i,K,J)},checkPoint:function(H,M,L,I,i,K,J){return B.pointInsidePolygon(H,M,q.triangle.points,K,J,I,i,[0,-1],L)}};q.square={points:k(4,0),draw:function(H,K,J,I,i){B.drawPolygon(H,K,J,I,i,q.square.points)},drawPath:function(H,K,J,I,i){B.drawPolygonPath(H,K,J,I,i,q.square.points)},intersectLine:function(K,J,I,H,i,M,L){return B.polygonIntersectLine(i,M,q.square.points,K,J,I/2,H/2,L)
},intersectBox:function(I,N,i,L,H,P,K,J,M){var O=q.square.points;return B.boxIntersectPolygon(I,N,i,L,O,H,P,K,J,[0,-1],M)},checkPointRough:function(H,M,L,I,i,K,J){return B.checkInBoundingBox(H,M,q.square.points,L,I,i,K,J)},checkPoint:function(H,M,L,I,i,K,J){return B.pointInsidePolygon(H,M,q.square.points,K,J,I,i,[0,-1],L)}};q.rectangle=q.square;q.octogon={};q.roundrectangle={points:k(4,0),draw:function(H,K,J,I,i){B.drawRoundRectangle(H,K,J,I,i,10)},drawPath:function(H,K,J,I,i){B.drawRoundRectanglePath(H,K,J,I,i,10)
},intersectLine:function(K,J,I,H,i,M,L){return B.roundRectangleIntersectLine(i,M,K,J,I,H,L)},intersectBox:function(I,N,i,L,H,O,K,J,M){return B.roundRectangleIntersectBox(I,N,i,L,H,O,K,J,M)},checkPointRough:function(H,M,L,I,i,K,J){return B.checkInBoundingBox(H,M,q.roundrectangle.points,L,I,i,K,J)},checkPoint:function(N,L,M,i,O,J,H){var K=B.getRoundRectangleRadius(i,O);if(B.pointInsidePolygon(N,L,q.roundrectangle.points,J,H,i,O-2*K,[0,-1],M)){return true}if(B.pointInsidePolygon(N,L,q.roundrectangle.points,J,H,i-2*K,O,[0,-1],M)){return true
}var I=function(Q,V,U,S,R,P,T){Q-=U;V-=S;Q/=(R/2+T);V/=(P/2+T);return(Math.pow(Q,2)+Math.pow(V,2)<=1)};if(I(N,L,J-i/2+K,H-O/2+K,K*2,K*2,M)){return true}if(I(N,L,J+i/2-K,H-O/2+K,K*2,K*2,M)){return true}if(I(N,L,J+i/2-K,H+O/2-K,K*2,K*2,M)){return true}if(I(N,L,J-i/2+K,H+O/2-K,K*2,K*2,M)){return true}return false}};q.roundrectangle2={roundness:4.99,draw:function(I,H,i){if(H<=roundness*2){return}B.drawPolygon(I._private.position.x,I._private.position.y,H,i,nodeSapes.roundrectangle2.points)},intersectLine:function(J,I,H,i,K){return B.findPolygonIntersection(J,I,H,i,K,q.square.points)
},intersectBox:function(I,N,i,L,H,P,K,J,M){var O=q.square.points}};q.pentagon={points:k(5,0),draw:function(H,K,J,I,i){B.drawPolygon(H,K,J,I,i,q.pentagon.points)},drawPath:function(H,K,J,I,i){B.drawPolygonPath(H,K,J,I,i,q.pentagon.points)},intersectLine:function(K,J,I,H,i,M,L){return B.polygonIntersectLine(i,M,q.pentagon.points,K,J,I/2,H/2,L)},intersectBox:function(I,N,i,L,H,P,K,J,M){var O=q.pentagon.points;return B.boxIntersectPolygon(I,N,i,L,O,H,P,K,J,[0,-1],M)},checkPointRough:function(H,M,L,I,i,K,J){return B.checkInBoundingBox(H,M,q.pentagon.points,L,I,i,K,J)
},checkPoint:function(H,M,L,I,i,K,J){return B.pointInsidePolygon(H,M,q.pentagon.points,K,J,I,i,[0,-1],L)}};q.hexagon={points:k(6,0),draw:function(H,K,J,I,i){B.drawPolygon(H,K,J,I,i,q.hexagon.points)},drawPath:function(H,K,J,I,i){B.drawPolygonPath(H,K,J,I,i,q.hexagon.points)},intersectLine:function(K,J,I,H,i,M,L){return B.polygonIntersectLine(i,M,q.hexagon.points,K,J,I/2,H/2,L)},intersectBox:function(I,N,i,L,H,P,K,J,M){var O=q.hexagon.points;return B.boxIntersectPolygon(I,N,i,L,O,H,P,K,J,[0,-1],M)
},checkPointRough:function(H,M,L,I,i,K,J){return B.checkInBoundingBox(H,M,q.hexagon.points,L,I,i,K,J)},checkPoint:function(H,M,L,I,i,K,J){return B.pointInsidePolygon(H,M,q.hexagon.points,K,J,I,i,[0,-1],L)}};q.heptagon={points:k(7,0),draw:function(H,K,J,I,i){B.drawPolygon(H,K,J,I,i,q.heptagon.points)},drawPath:function(H,K,J,I,i){B.drawPolygonPath(H,K,J,I,i,q.heptagon.points)},intersectLine:function(K,J,I,H,i,M,L){return B.polygonIntersectLine(i,M,q.heptagon.points,K,J,I/2,H/2,L)},intersectBox:function(I,N,i,L,H,P,K,J,M){var O=q.heptagon.points;
return B.boxIntersectPolygon(I,N,i,L,O,H,P,K,J,[0,-1],M)},checkPointRough:function(H,M,L,I,i,K,J){return B.checkInBoundingBox(H,M,q.heptagon.points,L,I,i,K,J)},checkPoint:function(H,M,L,I,i,K,J){return B.pointInsidePolygon(H,M,q.heptagon.points,K,J,I,i,[0,-1],L)}};q.octagon={points:k(8,0),draw:function(H,K,J,I,i){B.drawPolygon(H,K,J,I,i,q.octagon.points)},drawPath:function(H,K,J,I,i){B.drawPolygonPath(H,K,J,I,i,q.octagon.points)},intersectLine:function(K,J,I,H,i,M,L){return B.polygonIntersectLine(i,M,q.octagon.points,K,J,I/2,H/2,L)
},intersectBox:function(I,N,i,L,H,P,K,J,M){var O=q.octagon.points;return B.boxIntersectPolygon(I,N,i,L,O,H,P,K,J,[0,-1],M)},checkPointRough:function(H,M,L,I,i,K,J){return B.checkInBoundingBox(H,M,q.octagon.points,L,I,i,K,J)},checkPoint:function(H,M,L,I,i,K,J){return B.pointInsidePolygon(H,M,q.octagon.points,K,J,I,i,[0,-1],L)}};var j=new Array(20);var g=k(5,0);var F=k(5,Math.PI/5);var o=0.5*(3-Math.sqrt(5));o*=1.57;for(var E=0;E<F.length/2;E++){F[E*2]*=o;F[E*2+1]*=o}for(var E=0;E<20/4;E++){j[E*4]=g[E*2];
j[E*4+1]=g[E*2+1];j[E*4+2]=F[E*2];j[E*4+3]=F[E*2+1]}q.star5={points:j,draw:function(H,K,J,I,i){B.drawPolygon(H,K,J,I,i,q.star5.points)},drawPath:function(H,K,J,I,i){B.drawPolygonPath(H,K,J,I,i,q.star5.points)},intersectLine:function(K,J,I,H,i,M,L){return B.polygonIntersectLine(i,M,q.star5.points,K,J,I/2,H/2,L)},intersectBox:function(I,N,i,L,H,P,K,J,M){var O=q.star5.points;return B.boxIntersectPolygon(I,N,i,L,O,H,P,K,J,[0,-1],M)},checkPointRough:function(H,M,L,I,i,K,J){return B.checkInBoundingBox(H,M,q.star5.points,L,I,i,K,J)
},checkPoint:function(H,M,L,I,i,K,J){return B.pointInsidePolygon(H,M,q.star5.points,K,J,I,i,[0,-1],L)}};z.prototype.expandPolygon=function(T,J){var K=new Array(T.length*2);var S,R,Q,P;for(var N=0;N<T.length/2;N++){S=T[N*2];R=T[N*2+1];if(N<T.length/2-1){Q=T[(N+1)*2];P=T[(N+1)*2+1]}else{Q=T[0];P=T[1]}var O=(P-R);var M=-(Q-S);var L=Math.sqrt(O*O+M*M);var I=O/L;var H=M/L;K[N*4]=S+I*J;K[N*4+1]=R+H*J;K[N*4+2]=Q+I*J;K[N*4+3]=P+H*J}return K};z.prototype.joinLines=function(Q){var P=new Array(Q.length/2);var S,R,O,N;
var L,K,J,I;for(var M=0;M<Q.length/4;M++){S=Q[M*4];R=Q[M*4+1];O=Q[M*4+2];N=Q[M*4+3];if(M<Q.length/4-1){L=Q[(M+1)*4];K=Q[(M+1)*4+1];J=Q[(M+1)*4+2];I=Q[(M+1)*4+3]}else{L=Q[0];K=Q[1];J=Q[2];I=Q[3]}var H=this.finiteLinesIntersect(S,R,O,N,L,K,J,I,true);P[M*2]=H[0];P[M*2+1]=H[1]}return P};z.prototype.pointInsidePolygon=function(S,Q,M,P,N,W,V,ac,U){var O=new Array(M.length);var ab=Math.asin(ac[1]/(Math.sqrt(ac[0]*ac[0]+ac[1]*ac[1])));if(ac[0]<0){ab=ab+Math.PI/2}else{ab=-ab-Math.PI/2}var J=Math.cos(-ab);
var H=Math.sin(-ab);for(var Y=0;Y<O.length/2;Y++){O[Y*2]=W/2*(M[Y*2]*J-M[Y*2+1]*H);O[Y*2+1]=V/2*(M[Y*2+1]*J+M[Y*2]*H);O[Y*2]+=P;O[Y*2+1]+=N}var X;if(U>0){var ad=B.expandPolygon(O,-U);X=B.joinLines(ad)}else{X=O}var aa,L,Z,K;var I;var R=0;var T=0;for(var Y=0;Y<X.length/2;Y++){aa=X[Y*2];L=X[Y*2+1];if(Y+1<X.length/2){Z=X[(Y+1)*2];K=X[(Y+1)*2+1]}else{Z=X[(Y+1-X.length/2)*2];K=X[(Y+1-X.length/2)*2+1]}if(aa==S&&Z==S){}else{if((aa>=S&&S>=Z)||(aa<=S&&S<=Z)){I=(S-aa)/(Z-aa)*(K-L)+L;if(I>Q){R++}if(I<Q){T++}}else{continue
}}}if(R%2==0){return false}else{return true}};z.prototype.drawPolygonPath=function(K,I,N,M,H,L){K.translate(I,N);K.scale(M/2,H/2);K.beginPath();K.moveTo(L[0],L[1]);for(var J=1;J<L.length/2;J++){K.lineTo(L[J*2],L[J*2+1])}K.closePath();K.scale(2/M,2/H);K.translate(-I,-N)};z.prototype.drawPolygon=function(I,H,L,K,i,J){this.drawPolygonPath(I,H,L,K,i,J);I.fill()};z.prototype.getRoundRectangleRadius=function(H,i){return Math.min(H/2,i/2,10)};z.prototype.drawRoundRectanglePath=function(H,N,M,i,O,K){var I=i/2;
var L=O/2;var J=this.getRoundRectangleRadius(i,O);H.translate(N,M);H.beginPath();H.moveTo(0,-L);H.arcTo(I,-L,I,0,J);H.arcTo(I,L,0,L,J);H.arcTo(-I,L,-I,0,J);H.arcTo(-I,-L,0,-L,J);H.lineTo(0,-L);H.closePath();H.translate(-N,-M)};z.prototype.drawRoundRectangle=function(J,I,L,K,H,i){this.drawRoundRectanglePath(J,I,L,K,H,i);J.fill()};z.prototype.roundRectangleIntersectLine=function(ae,ad,ap,am,H,J,ai){var ag=this.getRoundRectangleRadius(H,J);var U=H/2;var K=J/2;var I;var O=ap-U+ag-ai;var N=am-K-ai;var ak=ap+U-ag+ai;
var aj=N;I=this.finiteLinesIntersect(ae,ad,ap,am,O,N,ak,aj,false);if(I.length>0){return I}var ah=ap+U+ai;var af=am-K+ag-ai;var i=ah;var an=am+K-ag+ai;I=this.finiteLinesIntersect(ae,ad,ap,am,ah,af,i,an,false);if(I.length>0){return I}var ab=ap-U+ag-ai;var Z=am+K+ai;var S=ap+U-ag+ai;var R=Z;I=this.finiteLinesIntersect(ae,ad,ap,am,ab,Z,S,R,false);if(I.length>0){return I}var Y=ap-U-ai;var X=am-K+ag-ai;var W=Y;var V=am+K-ag+ai;I=this.finiteLinesIntersect(ae,ad,ap,am,Y,X,W,V,false);if(I.length>0){return I
}var T;var Q=ap-U+ag;var P=am-K+ag;T=this.intersectLineCircle(ae,ad,ap,am,Q,P,ag+ai);if(T.length>0&&T[0]<=Q&&T[1]<=P){return[T[0],T[1]]}var M=ap+U-ag;var L=am-K+ag;T=this.intersectLineCircle(ae,ad,ap,am,M,L,ag+ai);if(T.length>0&&T[0]>=M&&T[1]<=L){return[T[0],T[1]]}var ao=ap+U-ag;var al=am+K-ag;T=this.intersectLineCircle(ae,ad,ap,am,ao,al,ag+ai);if(T.length>0&&T[0]>=ao&&T[1]>=al){return[T[0],T[1]]}var ac=ap-U+ag;var aa=am+K-ag;T=this.intersectLineCircle(ae,ad,ap,am,ac,aa,ag+ai);if(T.length>0&&T[0]<=ac&&T[1]>=aa){return[T[0],T[1]]
}};z.prototype.roundRectangleIntersectBox=function(M,S,L,R,T,Q,O,N,P){var I=this.getRoundRectangleRadius(T,Q);var H=O-T/2-P;var i=N-Q/2+I-P;var V=O+T/2+P;var U=N+Q/2-I+P;var Y=O-T/2+I-P;var W=N-Q/2-P;var K=O+T/2-I+P;var J=N+Q/2+P;var ab=Math.min(M,L);var aa=Math.max(M,L);var Z=Math.min(S,R);var X=Math.max(S,R);if(aa<H){return false}else{if(ab>V){return false}}if(X<W){return false}else{if(Z>J){return false}}if(H>=ab&&H<=aa&&i>=Z&&i<=X){return true}if(V>=ab&&V<=aa&&i>=Z&&i<=X){return true}if(V>=ab&&V<=aa&&U>=Z&&U<=X){return true
}if(H>=ab&&H<=aa&&U>=Z&&U<=X){return true}if(ab>=H&&ab<=V&&Z>=i&&Z<=U){return true}if(aa>=H&&aa<=V&&Z>=i&&Z<=U){return true}if(aa>=H&&aa<=V&&X>=i&&X<=U){return true}if(ab>=H&&ab<=V&&X>=i&&X<=U){return true}if(Y>=ab&&Y<=aa&&W>=Z&&W<=X){return true}if(K>=ab&&K<=aa&&W>=Z&&W<=X){return true}if(K>=ab&&K<=aa&&J>=Z&&J<=X){return true}if(Y>=ab&&Y<=aa&&J>=Z&&J<=X){return true}if(ab>=Y&&ab<=K&&Z>=W&&Z<=J){return true}if(aa>=Y&&aa<=K&&Z>=W&&Z<=J){return true}if(aa>=Y&&aa<=K&&X>=W&&X<=J){return true}if(ab>=Y&&ab<=K&&X>=W&&X<=J){return true
}if(this.boxIntersectEllipse(ab,Z,aa,X,P,I*2,I*2,Y+P,i+P)){return true}if(this.boxIntersectEllipse(ab,Z,aa,X,P,I*2,I*2,K-P,i+P)){return true}if(this.boxIntersectEllipse(ab,Z,aa,X,P,I*2,I*2,K-P,U-P)){return true}if(this.boxIntersectEllipse(ab,Z,aa,X,P,I*2,I*2,Y+P,U-P)){return true}return false};z.prototype.checkInBoundingCircle=function(H,N,I,M,J,i,L,K){H=(H-L)/(J+M);N=(N-K)/(i+M);return(H*H+N*N)<=I};z.prototype.checkInBoundingBox=function(R,P,S,Q,J,T,N,M){var L=S[0],K=S[1];var I=S[0],H=S[1];for(var O=1;
O<S.length/2;O++){if(S[O*2]<L){L=S[O*2]}else{if(S[O*2]>I){I=S[O*2]}}if(S[O*2+1]<K){K=S[O*2+1]}else{if(S[O*2+1]>H){H=S[O*2+1]}}}R-=N;P-=M;R/=J;P/=T;if(R<L){return false}else{if(R>I){return false}}if(P<K){return false}else{if(P>H){return false}}return true};z.prototype.boxInBezierVicinity=function(T,N,Z,Q,V,M,U,L,R,J,S){var P=0.25*V+0.5*U+0.25*R;var O=0.25*M+0.5*L+0.25*J;var aa=Math.min(T,Z)-S;var X=Math.min(N,Q)-S;var Y=Math.max(T,Z)+S;var W=Math.max(N,Q)+S;if(V>=aa&&V<=Y&&M>=X&&M<=W){return 1}else{if(R>=aa&&R<=Y&&J>=X&&J<=W){return 1
}else{if(P>=aa&&P<=Y&&O>=X&&O<=W){return 1}else{if(U>=aa&&U<=Y&&L>=X&&L<=W){return 1}}}}var K=Math.min(V,P,R);var I=Math.min(M,O,J);var H=Math.max(V,P,R);var i=Math.max(M,O,J);if(K>Y||H<aa||I>W||i<X){return 0}return 1};z.prototype.checkBezierInBox=function(L,K,T,Q,J,P,I,O,i,N,M){function H(X,W,V,U){return(1-U)*(1-U)*X+2*(1-U)*U*W+U*U*V}function S(V){var U=H(J,I,i,V);var W=H(P,O,N,V);return L<=U&&U<=T&&K<=W&&W<=Q}for(var R=0;R<=1;R+=0.25){if(!S(R)){return false}}return true};z.prototype.checkStraightEdgeInBox=function(J,I,O,N,H,M,i,L,K){return J<=H&&H<=O&&J<=i&&i<=O&&I<=M&&M<=N&&I<=L&&L<=N
};z.prototype.checkStraightEdgeCrossesBox=function(U,O,ab,R,W,K,V,H,T){var ac=Math.min(U,ab)-T;var Z=Math.min(O,R)-T;var aa=Math.max(U,ab)+T;var Y=Math.max(O,R)+T;var L=V-W;var Q=W;var X;var I=H-K;var P=K;var S;if(Math.abs(L)<0.0001){return(W>=ac&&W<=aa&&Math.min(K,H)<=Z&&Math.max(K,H)>=Y)}var i=(ac-Q)/L;if(i>0&&i<=1){X=I*i+P;if(X>=Z&&X<=Y){return true}}var N=(aa-Q)/L;if(N>0&&N<=1){X=I*N+P;if(X>=Z&&X<=Y){return true}}var J=(Z-P)/I;if(J>0&&J<=1){S=L*J+Q;if(S>=ac&&S<=aa){return true}}var M=(Y-P)/I;
if(M>0&&M<=1){S=L*M+Q;if(S>=ac&&S<=aa){return true}}return false};z.prototype.checkBezierCrossesBox=function(Z,L,am,ab,T,aw,P,at,N,ap,H){var V=Math.min(Z,am)-H;var S=Math.min(L,ab)-H;var av=Math.max(Z,am)+H;var ar=Math.max(L,ab)+H;if(T>=V&&T<=av&&aw>=S&&aw<=ar){return true}else{if(N>=V&&N<=av&&ap>=S&&ap<=ar){return true}}var Y=T-2*P+N;var K=-2*T+2*P;var ai=T;var ac=[];if(Math.abs(Y)<0.0001){var an=(V-T)/K;var aa=(av-T)/K;ac.push(an,aa)}else{var af=K*K-4*Y*(ai-V);var W,U;if(af>0){var ag=Math.sqrt(af);
W=(-K+ag)/(2*Y);U=(-K-ag)/(2*Y);ac.push(W,U)}var ae=K*K-4*Y*(ai-av);var R,O;if(ae>0){var ag=Math.sqrt(ae);R=(-K+ag)/(2*Y);O=(-K-ag)/(2*Y);ac.push(R,O)}}ac.sort(function(ay,ax){return ay-ax});var X=aw-2*at+ap;var I=-2*aw+2*at;var ah=aw;var al=[];if(Math.abs(X)<0.0001){var J=(S-aw)/I;var aj=(ar-aw)/I;al.push(J,aj)}else{var Q=I*I-4*X*(ah-S);var i,au;if(Q>0){var ag=Math.sqrt(Q);i=(-I+ag)/(2*X);au=(-I-ag)/(2*X);al.push(i,au)}var M=I*I-4*X*(ah-ar);var aq,ao;if(M>0){var ag=Math.sqrt(M);aq=(-I+ag)/(2*X);
ao=(-I-ag)/(2*X);al.push(aq,ao)}}al.sort(function(ay,ax){return ay-ax});for(var ad=0;ad<ac.length;ad+=2){for(var ak=1;ak<al.length;ak+=2){if(ac[ad]<al[ak]&&al[ak]>=0&&ac[ad]<=1&&ac[ad+1]>al[ak-1]&&al[ak-1]<=1&&ac[ad+1]>=0){return true}}}return false};z.prototype.inLineVicinity=function(Q,O,L,J,K,I,M){var R=M;var H=Math.min(L,K);var i=Math.max(L,K);var P=Math.min(J,I);var N=Math.max(J,I);return H-R<=Q&&Q<=i+R&&P-R<=O&&O<=N+R};z.prototype.inBezierVicinity=function(N,M,X,I,W,H,V,i,ac){var P=0.25*X+0.5*W+0.25*V;
var O=0.25*I+0.5*H+0.25*i;var K={x1:Math.min(X,V,P),x2:Math.max(X,V,P),y1:Math.min(I,i,O),y2:Math.max(I,i,O)};if(N<K.x1||N>K.x2||M<K.y1||M>K.y2){return false}else{}var S,R,aa,Y;var L,J,Q;var ab=function(ae,ak,af,ad,aj,ai,ag,ah){L=(ai-ad)*(ae-af)+(af-aj)*(ak-ad);J=L*L;sideSquared=(ai-ad)*(ai-ad)+(af-aj)*(af-aj);if(ah){if(L>0){return false}}else{if(L<0){return false}}return(J/sideSquared>ag)};var U=(P+W)/2;var T=(O+H)/2;var Z=true;if(ab(U,T,X,I,W,H,0,Z)){Z=!Z}return(!ab(N,M,X,I,W,H,ac,Z)&&!ab(N,M,W,H,V,i,ac,Z)&&!ab(N,M,V,i,X,I,ac,Z))
};z.prototype.solveCubic=function(O,N,M,L,S){N/=O;M/=O;L/=O;var Q,H,i,J,R,P,I,K;H=(3*M-(N*N))/9;i=-(27*L)+N*(9*M-2*(N*N));i/=54;Q=H*H*H+i*i;S[1]=0;I=(N/3);if(Q>0){R=i+Math.sqrt(Q);R=((R<0)?-Math.pow(-R,(1/3)):Math.pow(R,(1/3)));P=i-Math.sqrt(Q);P=((P<0)?-Math.pow(-P,(1/3)):Math.pow(P,(1/3)));S[0]=-I+R+P;I+=(R+P)/2;S[4]=S[2]=-I;I=Math.sqrt(3)*(-P+R)/2;S[3]=I;S[5]=-I;return}S[5]=S[3]=0;if(Q==0){K=((i<0)?-Math.pow(-i,(1/3)):Math.pow(i,(1/3)));S[0]=-I+2*K;S[4]=S[2]=-(K+I);return}H=-H;J=H*H*H;J=Math.acos(i/Math.sqrt(J));
K=2*Math.sqrt(H);S[0]=-I+K*Math.cos(J/3);S[2]=-I+K*Math.cos((J+2*Math.PI)/3);S[4]=-I+K*Math.cos((J+4*Math.PI)/3);return};z.prototype.sqDistanceToQuadraticBezier=function(R,Q,W,L,V,K,U,J){var ac=1*W*W-4*W*V+2*W*U+4*V*V-4*V*U+U*U+L*L-4*L*K+2*L*J+4*K*K-4*K*J+J*J;var ab=1*9*W*V-3*W*W-3*W*U-6*V*V+3*V*U+9*L*K-3*L*L-3*L*J-6*K*K+3*K*J;var Z=1*3*W*W-6*W*V+W*U-W*R+2*V*V+2*V*R-U*R+3*L*L-6*L*K+L*J-L*Q+2*K*K+2*K*Q-J*Q;var Y=1*W*V-W*W+W*R-V*R+L*K-L*L+L*Q-K*Q;A("coefficients: "+ac/ac+", "+ab/ac+", "+Z/ac+", "+Y/ac);
var M=[];this.solveCubic(ac,ab,Z,Y,M);var H=1e-7;var aa=[];for(var N=0;N<6;N+=2){if(Math.abs(M[N+1])<H&&M[N]>=0&&M[N]<=1){aa.push(M[N])}}aa.push(1);aa.push(0);var I=-1;var X;var P,O,S;for(var T=0;T<aa.length;T++){P=Math.pow(1-aa[T],2)*W+2*(1-aa[T])*aa[T]*V+aa[T]*aa[T]*U;O=Math.pow(1-aa[T],2)*L+2*(1-aa[T])*aa[T]*K+aa[T]*aa[T]*J;S=Math.pow(P-R,2)+Math.pow(O-Q,2);A("distance for param "+aa[T]+": "+Math.sqrt(S));if(I>=0){if(S<I){I=S;X=aa[T]}}else{I=S;X=aa[T]}}A("given: ( "+R+", "+Q+"), ( "+W+", "+L+"), ( "+V+", "+K+"), ( "+U+", "+J+")");
A("roots: "+M);A("params: "+aa);A("closest param: "+X);return I};z.prototype.sqDistanceToFiniteLine=function(O,L,H,N,i,M){var I=[O-H,L-N];var R=[i-H,M-N];var J=R[0]*R[0]+R[1]*R[1];var Q=I[0]*I[0]+I[1]*I[1];var P=I[0]*R[0]+I[1]*R[1];var K=P*P/J;if(P<0){return Q}if(K>J){return(O-i)*(O-i)+(L-M)*(L-M)}return(Q-K)};var A=function(){};w("renderer","canvas",z)})(cytoscape);